import{computed as e,reactive as t,ref as r,watch as s,mergeProps as a,withCtx as o,createVNode as i,withModifiers as d,withDirectives as l,createBlock as u,createCommentVNode as n,createTextVNode as p,vModelText as m,openBlock as c,toDisplayString as b,Fragment as x,renderList as g,vModelSelect as y,useSSRContext as f}from"vue";import{ssrRenderComponent as v,ssrRenderAttr as $,ssrRenderClass as h,ssrInterpolate as k,ssrRenderList as _,ssrIncludeBooleanAttr as E,ssrLooseContain as w,ssrLooseEqual as q}from"vue/server-renderer";import{R as U}from"./Modal-CcMmmM3q.mjs";import{E as V}from"./useApiClient-LtAAs9ek.mjs";import"./_plugin-vue_export-helper-DlAUqK2U.mjs";import"axios";import"./server.mjs";import"../_/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"node:url";import"../routes/renderer.mjs";import"vue-bundle-renderer/runtime";import"unhead/server";import"devalue";import"unhead/utils";import"vue-router";const j={__name:"variant-form",__ssrInlineRender:!0,props:{show:Boolean,variant:Object,productId:[String,Number],apiErrors:{type:Object,default:()=>({})},mode:String},emits:["submit","cancel","created","updated"],setup(f,{emit:j}){V();const S=f,A=j,N=e({get:()=>S.show,set:()=>G()}),C=e(()=>"edit"===S.mode?"Chỉnh sửa biến thể":"Thêm biến thể mới"),O=t({sku:"",barcode:"",price:"",sale_price:"",quantity:"",image:"",status:"",attribute_values:{}}),T=t({}),R=r(!1),K=r({}),B=r([]);function R$1(){Object.keys(T).forEach(e=>delete T[e])}function J(){if(R$1(),O.sku.trim()?O.sku.length>100&&(T.sku="SKU không được vượt quá 100 ký tự"):T.sku="SKU là bắt buộc",!O.price||isNaN(O.price)?T.price="Giá là bắt buộc và phải là số":Number(O.price)<0&&(T.price="Giá không được âm"),O.sale_price&&(isNaN(O.sale_price)||Number(O.sale_price)<0)&&(T.sale_price="Giá khuyến mãi phải là số và không được âm"),!O.quantity||isNaN(O.quantity)?T.quantity="Số lượng là bắt buộc và phải là số":Number(O.quantity)<0&&(T.quantity="Số lượng không được âm"),O.image&&O.image.length>255&&(T.image="Đường dẫn ảnh không được vượt quá 255 ký tự"),0===Object.keys(T).length){R.value=!0;try{const e=new FormData;Object.entries(O).forEach(([t,r])=>{"attribute_values"!==t&&null!=r&&""!==r&&e.append(t,r)}),e.append("product_id",S.productId),Object.entries(O.attribute_values).forEach(([t,r])=>{r&&e.append(`attribute_values[${t}]`,r)}),A("submit",e)}finally{R.value=!1}}}function G(){A("cancel")}return s(()=>S.variant,e=>{e?(O.sku=e.sku||"",O.barcode=e.barcode||"",O.price=e.price||"",O.sale_price=e.sale_price||"",O.quantity=e.quantity||"",O.image=e.image||"",O.status=e.status||Object.keys(K.value)[0]||"",e.attribute_values&&e.attribute_values.forEach(e=>{O.attribute_values[e.attribute_id]=e.id})):(O.sku="",O.barcode="",O.price="",O.sale_price="",O.quantity="",O.image="",O.status=Object.keys(K.value)[0]||"",O.attribute_values={},R$1())},{immediate:!0}),(e,t,r,s)=>{t(v(U,a({modelValue:N.value,"onUpdate:modelValue":e=>N.value=e,title:C.value},s),{default:o((e,t,r,s)=>{if(!t)return[i("form",{onSubmit:d(J,["prevent"]),class:"space-y-4"},[i("div",null,[i("label",{class:"block text-sm font-medium mb-1"},[p("SKU "),i("span",{class:"text-red-500"},"*")]),l(i("input",{"onUpdate:modelValue":e=>O.sku=e,type:"text",class:["w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",{"border-red-500":T.sku||f.apiErrors.sku}],maxlength:"100"},null,10,["onUpdate:modelValue"]),[[m,O.sku]]),T.sku?(c(),u("p",{key:0,class:"mt-1 text-sm text-red-600"},b(T.sku),1)):f.apiErrors.sku?(c(),u("p",{key:1,class:"mt-1 text-sm text-red-600"},b(f.apiErrors.sku),1)):n("",!0)]),i("div",null,[i("label",{class:"block text-sm font-medium mb-1"},"Barcode"),l(i("input",{"onUpdate:modelValue":e=>O.barcode=e,type:"text",class:["w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",{"border-red-500":T.barcode||f.apiErrors.barcode}],maxlength:"100"},null,10,["onUpdate:modelValue"]),[[m,O.barcode]]),T.barcode?(c(),u("p",{key:0,class:"mt-1 text-sm text-red-600"},b(T.barcode),1)):f.apiErrors.barcode?(c(),u("p",{key:1,class:"mt-1 text-sm text-red-600"},b(f.apiErrors.barcode),1)):n("",!0)]),i("div",{class:"grid grid-cols-2 gap-4"},[i("div",null,[i("label",{class:"block text-sm font-medium mb-1"},[p("Giá gốc "),i("span",{class:"text-red-500"},"*")]),l(i("input",{"onUpdate:modelValue":e=>O.price=e,type:"number",step:"0.01",class:["w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",{"border-red-500":T.price||f.apiErrors.price}]},null,10,["onUpdate:modelValue"]),[[m,O.price]]),T.price?(c(),u("p",{key:0,class:"mt-1 text-sm text-red-600"},b(T.price),1)):f.apiErrors.price?(c(),u("p",{key:1,class:"mt-1 text-sm text-red-600"},b(f.apiErrors.price),1)):n("",!0)]),i("div",null,[i("label",{class:"block text-sm font-medium mb-1"},"Giá khuyến mãi"),l(i("input",{"onUpdate:modelValue":e=>O.sale_price=e,type:"number",step:"0.01",class:["w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",{"border-red-500":T.sale_price||f.apiErrors.sale_price}]},null,10,["onUpdate:modelValue"]),[[m,O.sale_price]]),T.sale_price?(c(),u("p",{key:0,class:"mt-1 text-sm text-red-600"},b(T.sale_price),1)):f.apiErrors.sale_price?(c(),u("p",{key:1,class:"mt-1 text-sm text-red-600"},b(f.apiErrors.sale_price),1)):n("",!0)])]),i("div",null,[i("label",{class:"block text-sm font-medium mb-1"},[p("Số lượng "),i("span",{class:"text-red-500"},"*")]),l(i("input",{"onUpdate:modelValue":e=>O.quantity=e,type:"number",class:["w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",{"border-red-500":T.quantity||f.apiErrors.quantity}]},null,10,["onUpdate:modelValue"]),[[m,O.quantity]]),T.quantity?(c(),u("p",{key:0,class:"mt-1 text-sm text-red-600"},b(T.quantity),1)):f.apiErrors.quantity?(c(),u("p",{key:1,class:"mt-1 text-sm text-red-600"},b(f.apiErrors.quantity),1)):n("",!0)]),i("div",null,[i("label",{class:"block text-sm font-medium mb-1"},"Ảnh biến thể (URL)"),l(i("input",{"onUpdate:modelValue":e=>O.image=e,type:"text",class:["w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",{"border-red-500":T.image||f.apiErrors.image}],maxlength:"255"},null,10,["onUpdate:modelValue"]),[[m,O.image]]),T.image?(c(),u("p",{key:0,class:"mt-1 text-sm text-red-600"},b(T.image),1)):f.apiErrors.image?(c(),u("p",{key:1,class:"mt-1 text-sm text-red-600"},b(f.apiErrors.image),1)):n("",!0)]),i("div",null,[i("label",{class:"block text-sm font-medium mb-1"},"Thuộc tính"),i("div",{class:"space-y-2"},[(c(!0),u(x,null,g(B.value,e=>(c(),u("div",{key:e.id,class:"flex items-center space-x-3"},[i("span",{class:"text-sm font-medium text-gray-700 w-24"},b(e.name)+":",1),l(i("select",{"onUpdate:modelValue":t=>O.attribute_values[e.id]=t,class:"flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"},[i("option",{value:""},"Chọn giá trị"),(c(!0),u(x,null,g(e.values,e=>(c(),u("option",{key:e.id,value:e.id},b(e.value),9,["value"]))),128))],8,["onUpdate:modelValue"]),[[y,O.attribute_values[e.id]]])]))),128))])]),i("div",null,[i("label",{class:"block text-sm font-medium mb-1"},[p("Trạng thái "),i("span",{class:"text-red-500"},"*")]),l(i("select",{"onUpdate:modelValue":e=>O.status=e,class:["w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",{"border-red-500":T.status||f.apiErrors.status}]},[(c(!0),u(x,null,g(K.value,(e,t)=>(c(),u("option",{key:t,value:t},b(e),9,["value"]))),128))],10,["onUpdate:modelValue"]),[[y,O.status]]),T.status?(c(),u("p",{key:0,class:"mt-1 text-sm text-red-600"},b(T.status),1)):f.apiErrors.status?(c(),u("p",{key:1,class:"mt-1 text-sm text-red-600"},b(f.apiErrors.status),1)):n("",!0)]),i("div",{class:"flex justify-end space-x-3 pt-4"},[i("button",{type:"button",onClick:G,class:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none"},"Huỷ"),i("button",{type:"submit",class:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none",disabled:R.value},b(R.value?"Đang xử lý...":"edit"===f.mode?"Cập nhật":"Thêm mới"),9,["disabled"])])],32)];t(`<form class="space-y-4"${s}><div${s}><label class="block text-sm font-medium mb-1"${s}>SKU <span class="text-red-500"${s}>*</span></label><input${$("value",O.sku)} type="text" class="${h([{"border-red-500":T.sku||f.apiErrors.sku},"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"])}" maxlength="100"${s}>`),T.sku?t(`<p class="mt-1 text-sm text-red-600"${s}>${k(T.sku)}</p>`):f.apiErrors.sku?t(`<p class="mt-1 text-sm text-red-600"${s}>${k(f.apiErrors.sku)}</p>`):t("\x3c!----\x3e"),t(`</div><div${s}><label class="block text-sm font-medium mb-1"${s}>Barcode</label><input${$("value",O.barcode)} type="text" class="${h([{"border-red-500":T.barcode||f.apiErrors.barcode},"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"])}" maxlength="100"${s}>`),T.barcode?t(`<p class="mt-1 text-sm text-red-600"${s}>${k(T.barcode)}</p>`):f.apiErrors.barcode?t(`<p class="mt-1 text-sm text-red-600"${s}>${k(f.apiErrors.barcode)}</p>`):t("\x3c!----\x3e"),t(`</div><div class="grid grid-cols-2 gap-4"${s}><div${s}><label class="block text-sm font-medium mb-1"${s}>Giá gốc <span class="text-red-500"${s}>*</span></label><input${$("value",O.price)} type="number" step="0.01" class="${h([{"border-red-500":T.price||f.apiErrors.price},"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"])}"${s}>`),T.price?t(`<p class="mt-1 text-sm text-red-600"${s}>${k(T.price)}</p>`):f.apiErrors.price?t(`<p class="mt-1 text-sm text-red-600"${s}>${k(f.apiErrors.price)}</p>`):t("\x3c!----\x3e"),t(`</div><div${s}><label class="block text-sm font-medium mb-1"${s}>Giá khuyến mãi</label><input${$("value",O.sale_price)} type="number" step="0.01" class="${h([{"border-red-500":T.sale_price||f.apiErrors.sale_price},"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"])}"${s}>`),T.sale_price?t(`<p class="mt-1 text-sm text-red-600"${s}>${k(T.sale_price)}</p>`):f.apiErrors.sale_price?t(`<p class="mt-1 text-sm text-red-600"${s}>${k(f.apiErrors.sale_price)}</p>`):t("\x3c!----\x3e"),t(`</div></div><div${s}><label class="block text-sm font-medium mb-1"${s}>Số lượng <span class="text-red-500"${s}>*</span></label><input${$("value",O.quantity)} type="number" class="${h([{"border-red-500":T.quantity||f.apiErrors.quantity},"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"])}"${s}>`),T.quantity?t(`<p class="mt-1 text-sm text-red-600"${s}>${k(T.quantity)}</p>`):f.apiErrors.quantity?t(`<p class="mt-1 text-sm text-red-600"${s}>${k(f.apiErrors.quantity)}</p>`):t("\x3c!----\x3e"),t(`</div><div${s}><label class="block text-sm font-medium mb-1"${s}>Ảnh biến thể (URL)</label><input${$("value",O.image)} type="text" class="${h([{"border-red-500":T.image||f.apiErrors.image},"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"])}" maxlength="255"${s}>`),T.image?t(`<p class="mt-1 text-sm text-red-600"${s}>${k(T.image)}</p>`):f.apiErrors.image?t(`<p class="mt-1 text-sm text-red-600"${s}>${k(f.apiErrors.image)}</p>`):t("\x3c!----\x3e"),t(`</div><div${s}><label class="block text-sm font-medium mb-1"${s}>Thuộc tính</label><div class="space-y-2"${s}>\x3c!--[--\x3e`),_(B.value,e=>{t(`<div class="flex items-center space-x-3"${s}><span class="text-sm font-medium text-gray-700 w-24"${s}>${k(e.name)}:</span><select class="flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"${s}><option value=""${E(Array.isArray(O.attribute_values[e.id])?w(O.attribute_values[e.id],""):q(O.attribute_values[e.id],""))?" selected":""}${s}>Chọn giá trị</option>\x3c!--[--\x3e`),_(e.values,r=>{t(`<option${$("value",r.id)}${E(Array.isArray(O.attribute_values[e.id])?w(O.attribute_values[e.id],r.id):q(O.attribute_values[e.id],r.id))?" selected":""}${s}>${k(r.value)}</option>`)}),t("\x3c!--]--\x3e</select></div>")}),t(`\x3c!--]--\x3e</div></div><div${s}><label class="block text-sm font-medium mb-1"${s}>Trạng thái <span class="text-red-500"${s}>*</span></label><select class="${h([{"border-red-500":T.status||f.apiErrors.status},"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"])}"${s}>\x3c!--[--\x3e`),_(K.value,(e,r)=>{t(`<option${$("value",r)}${E(Array.isArray(O.status)?w(O.status,r):q(O.status,r))?" selected":""}${s}>${k(e)}</option>`)}),t("\x3c!--]--\x3e</select>"),T.status?t(`<p class="mt-1 text-sm text-red-600"${s}>${k(T.status)}</p>`):f.apiErrors.status?t(`<p class="mt-1 text-sm text-red-600"${s}>${k(f.apiErrors.status)}</p>`):t("\x3c!----\x3e"),t(`</div><div class="flex justify-end space-x-3 pt-4"${s}><button type="button" class="px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none"${s}>Huỷ</button><button type="submit" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none"${E(R.value)?" disabled":""}${s}>${k(R.value?"Đang xử lý...":"edit"===f.mode?"Cập nhật":"Thêm mới")}</button></div></form>`)}),_:1},r))}}},S=j.setup;j.setup=(e,t)=>{const r=f();return(r.modules||(r.modules=new Set)).add("pages/admin/products/variant-form.vue"),S?S(e,t):void 0};export{j as default};
