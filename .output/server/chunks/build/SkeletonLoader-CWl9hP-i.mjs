import{ref as e,reactive as a,computed as t,mergeProps as d,useSSRContext as i}from"vue";import{E as r}from"./useApiClient-LtAAs9ek.mjs";import{ssrRenderAttrs as l,ssrRenderList as c}from"vue/server-renderer";import{s as n}from"./_plugin-vue_export-helper-DlAUqK2U.mjs";function se(d,i={}){const l=r(),{defaultFilters:c={},defaultSort:n="created_at_desc",cacheEnabled:u=!0,debounceTime:g=300,pageSize:b=10}=i,p=e([]),m=e(!1),y=e(null),h=a({current_page:1,from:0,to:0,total:0,per_page:b,links:[]}),w=a({...c}),f=new Map;let x=null;const _=t(()=>p.value.length>0),j=t(()=>!m.value&&0===p.value.length),L=t(()=>1===h.current_page),S=t(()=>h.current_page===h.last_page),o=async(e={})=>{if(m.value)console.warn("API call already in progress, skipping...");else{m.value=!0,y.value=null;try{const a={...w,...e},t=(e=>JSON.stringify({...w,...e}))(a);if(u){const e=(e=>{const a=f.get(e);return a?Date.now()-a.timestamp>a.ttl?(f.delete(e),null):a.data:null})(t);if(e)return p.value=e.data,Object.assign(h,e.meta),m.value=!1,e}const i=await l.get(d,{params:a}),{data:r,meta:c}=i.data;return p.value=r,Object.assign(h,c),u&&((e,a,t=3e5)=>{f.set(e,{data:a,timestamp:Date.now(),ttl:t})})(t,{data:r,meta:c}),{data:r,meta:c}}catch(e){throw y.value=e.userMessage||"Lỗi tải dữ liệu",p.value=[],e}finally{m.value=!1}}};return{items:p,loading:m,error:y,pagination:h,filters:w,hasData:_,isEmpty:j,isFirstPage:L,isLastPage:S,fetchData:o,debouncedFetch:(e={})=>{x&&clearTimeout(x),x=setTimeout(()=>{o(e)},g)},updateFilters:e=>{Object.keys(e).some(a=>w[a]!==e[a])&&(Object.assign(w,e),o())},resetFilters:()=>{Object.keys(c).some(e=>w[e]!==c[e])&&(Object.assign(w,c),o())},changePage:e=>{o({page:e})},changePageSize:e=>{h.per_page=e,o({page:1,per_page:e})},createItem:async e=>{try{const a=await l.post(d,e);return await o(),a.data}catch(e){throw y.value=e.userMessage||"Lỗi tạo dữ liệu",e}},updateItem:async(e,a)=>{try{const t=await l.put(`${d}/${e}`,a);return await o(),t.data}catch(e){throw y.value=e.userMessage||"Lỗi cập nhật dữ liệu",e}},deleteItem:async e=>{try{await l.delete(`${d}/${e}`),await o()}catch(e){throw y.value=e.userMessage||"Lỗi xóa dữ liệu",e}},clearCache:()=>{f.clear()},refresh:()=>o()}}const u=e([]);let g=0;function de(){const s=(e,a="info",t=3e3)=>{const d=++g,i={id:d,message:e,type:a,duration:t,visible:!0};return u.value.push(i),setTimeout(()=>{v(d)},t),d},v=e=>{const a=u.value.findIndex(a=>a.id===e);a>-1&&(u.value[a].visible=!1,setTimeout(()=>{u.value.splice(a,1)},300))};return{toasts:u,showToast:s,showSuccess:(e,a)=>s(e,"success",a),showError:(e,a)=>s(e,"error",a),showWarning:(e,a)=>s(e,"warning",a),showInfo:(e,a)=>s(e,"info",a),removeToast:v,clearAll:()=>{u.value=[]}}}const b={__name:"CoreLoadingSkeletonLoader",__ssrInlineRender:!0,props:{type:{type:String,default:"default",validator:e=>["table","card","form","list","default"].includes(e)},rows:{type:Number,default:5},columns:{type:Number,default:4},fields:{type:Number,default:5},items:{type:Number,default:3}},setup:e=>(a,t,i,r)=>{t(`<div${l(d({class:"animate-pulse"},r))} data-v-2b5e9a70>`),"table"===e.type?(t('<div class="bg-white shadow-md rounded-lg overflow-hidden" data-v-2b5e9a70><div class="px-6 py-3 bg-gray-50 border-b border-gray-200" data-v-2b5e9a70><div class="flex justify-between items-center" data-v-2b5e9a70><div class="h-4 bg-gray-200 rounded w-1/4" data-v-2b5e9a70></div><div class="h-8 bg-gray-200 rounded w-24" data-v-2b5e9a70></div></div></div><div class="divide-y divide-gray-200" data-v-2b5e9a70>\x3c!--[--\x3e'),c(e.rows,a=>{t('<div class="px-6 py-4" data-v-2b5e9a70><div class="flex items-center space-x-4" data-v-2b5e9a70>\x3c!--[--\x3e'),c(e.columns,e=>{t('<div class="flex-1" data-v-2b5e9a70><div class="h-4 bg-gray-200 rounded" data-v-2b5e9a70></div></div>')}),t("\x3c!--]--\x3e</div></div>")}),t("\x3c!--]--\x3e</div></div>")):"card"===e.type?t('<div class="bg-white rounded-lg shadow-md p-6" data-v-2b5e9a70><div class="flex items-center space-x-4 mb-4" data-v-2b5e9a70><div class="w-12 h-12 bg-gray-200 rounded-full" data-v-2b5e9a70></div><div class="flex-1" data-v-2b5e9a70><div class="h-4 bg-gray-200 rounded w-3/4 mb-2" data-v-2b5e9a70></div><div class="h-3 bg-gray-200 rounded w-1/2" data-v-2b5e9a70></div></div></div><div class="space-y-2" data-v-2b5e9a70><div class="h-3 bg-gray-200 rounded" data-v-2b5e9a70></div><div class="h-3 bg-gray-200 rounded w-5/6" data-v-2b5e9a70></div><div class="h-3 bg-gray-200 rounded w-4/6" data-v-2b5e9a70></div></div></div>'):"form"===e.type?(t('<div class="space-y-6" data-v-2b5e9a70>\x3c!--[--\x3e'),c(e.fields,e=>{t('<div class="space-y-2" data-v-2b5e9a70><div class="h-4 bg-gray-200 rounded w-1/4" data-v-2b5e9a70></div><div class="h-10 bg-gray-200 rounded" data-v-2b5e9a70></div></div>')}),t('\x3c!--]--\x3e<div class="flex justify-end space-x-3 pt-4" data-v-2b5e9a70><div class="h-10 bg-gray-200 rounded w-20" data-v-2b5e9a70></div><div class="h-10 bg-gray-200 rounded w-20" data-v-2b5e9a70></div></div></div>')):"list"===e.type?(t('<div class="space-y-3" data-v-2b5e9a70>\x3c!--[--\x3e'),c(e.items,e=>{t('<div class="flex items-center space-x-3 p-3 bg-white rounded-lg shadow" data-v-2b5e9a70><div class="w-10 h-10 bg-gray-200 rounded" data-v-2b5e9a70></div><div class="flex-1" data-v-2b5e9a70><div class="h-4 bg-gray-200 rounded w-3/4 mb-1" data-v-2b5e9a70></div><div class="h-3 bg-gray-200 rounded w-1/2" data-v-2b5e9a70></div></div><div class="w-20 h-8 bg-gray-200 rounded" data-v-2b5e9a70></div></div>')}),t("\x3c!--]--\x3e</div>")):(t('<div class="space-y-3" data-v-2b5e9a70>\x3c!--[--\x3e'),c(e.items,e=>{t('<div class="h-4 bg-gray-200 rounded" data-v-2b5e9a70></div>')}),t("\x3c!--]--\x3e</div>")),t("</div>")}},p=b.setup;b.setup=(e,a)=>{const t=i();return(t.modules||(t.modules=new Set)).add("components/Core/Loading/SkeletonLoader.vue"),p?p(e,a):void 0};const m=n(b,[["__scopeId","data-v-2b5e9a70"]]);export{de as d,m as r,se as s};
