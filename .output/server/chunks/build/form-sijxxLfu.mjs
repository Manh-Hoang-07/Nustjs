import{computed as e,ref as l,watch as a,mergeProps as o,withCtx as r,createVNode as n,useSSRContext as t}from"vue";import{ssrRenderComponent as d}from"vue/server-renderer";import{R as i}from"./Modal-CcMmmM3q.mjs";import{j as u}from"./FormWrapper-BkWXOK5b.mjs";import{$ as s}from"./FormField-C25kxm9c.mjs";import{s as m}from"./apiClient-CZcLLw7q.mjs";import"./_plugin-vue_export-helper-DlAUqK2U.mjs";import"axios";const p={__name:"form",__ssrInlineRender:!0,props:{show:Boolean,inventory:{type:Object,default:null},apiErrors:{type:Object,default:()=>({})},products:{type:Array,default:()=>[]},warehouses:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["submit","cancel"],setup(t,{emit:p}){const c=t,_=p,h=e({get:()=>c.show,set:()=>x()}),v=l(null),g=l([]),y=l(""),V=e(()=>c.inventory?"Chỉnh sửa tồn kho":"Thêm tồn kho mới"),b=e(()=>({product_id:"",variant_id:"",warehouse_id:"",quantity:0,batch_no:"",lot_no:"",expiry_date:"",cost_price:null,reserved_quantity:0,...c.inventory||{}})),U=e(()=>({product_id:[{required:"Vui lòng chọn sản phẩm."}],warehouse_id:[{required:"Vui lòng chọn kho hàng."}],quantity:[{required:"Vui lòng nhập số lượng."},{integer:"Số lượng phải là số nguyên."},{min:[0,"Số lượng không được âm."]}],reserved_quantity:[{integer:"Số lượng đã giữ chỗ phải là số nguyên."},{min:[0,"Số lượng đã giữ chỗ không được âm."]}],batch_no:[{max:[100,"Mã lô hàng không được vượt quá 100 ký tự."]}],lot_no:[{max:[100,"Số lô sản xuất không được vượt quá 100 ký tự."]}],expiry_date:[{date:"Hạn sử dụng không đúng định dạng."},{after:["today","Hạn sử dụng phải sau ngày hiện tại."]}],cost_price:[{numeric:"Giá vốn phải là số."},{min:[0,"Giá vốn không được âm."]}]})),f=e(()=>[{value:"",label:"Chọn sản phẩm"},...c.products.map(e=>({value:e.id,label:`${e.name} (${e.code})`}))]),w=e(()=>[{value:"",label:"Chọn kho hàng"},...c.warehouses.map(e=>({value:e.id,label:e.name}))]),S=e(()=>{if(!y.value)return[{value:"",label:"Chọn sản phẩm trước"}];return[{value:"",label:"Không chọn biến thể"},...g.value.filter(e=>e.product_id==y.value).map(e=>({value:String(e.id),label:`${e.sku} - ${e.name||"Không có tên"}`}))]});async function q(e){y.value=e,c.inventory||(g.value=[]),e?await N(e):g.value=[]}async function N(e){try{const l=await m.get(`/api/admin/products/${e}/variants`);l.data.success?g.value=l.data.data||[]:g.value=l.data||[]}catch{g.value=[]}}function R$1(e){_("submit",e)}function x(){_("cancel")}return a(()=>c.inventory,e=>{e?.product_id&&(y.value=e.product_id,N(e.product_id))},{immediate:!0}),(e,l,a,m)=>{l(d(i,o({modelValue:h.value,"onUpdate:modelValue":e=>h.value=e,title:V.value,loading:t.loading,size:"4xl"},m),{default:r((e,l,a,o)=>{if(!l)return[n(u,{"default-values":b.value,rules:U.value,"api-errors":t.apiErrors,"submit-text":c.inventory?"Cập nhật":"Tạo tồn kho",onSubmit:R$1,onCancel:x,ref_key:"formWrapperRef",ref:v},{default:r(({form:e,errors:l,clearError:a,isSubmitting:o})=>[n("div",{class:"space-y-6"},[n("div",{class:"bg-gray-50 p-6 rounded-lg"},[n("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Thông tin tồn kho"),n("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-6"},[n("div",{class:"md:col-span-2"},[n(s,{modelValue:e.product_id,"onUpdate:modelValue":[l=>e.product_id=l,l=>{a("product_id"),q(l),c.inventory||(e.variant_id="")}],label:"Sản phẩm",name:"product_id",type:"select",options:f.value,error:l.product_id,required:""},null,8,["modelValue","onUpdate:modelValue","options","error"])]),n("div",{class:"md:col-span-2"},[n(s,{modelValue:e.variant_id,"onUpdate:modelValue":[l=>e.variant_id=l,e=>a("variant_id")],label:"Biến thể sản phẩm (Tùy chọn)",name:"variant_id",type:"select",options:S.value,error:l.variant_id},null,8,["modelValue","onUpdate:modelValue","options","error"])]),n("div",{class:"md:col-span-2"},[n(s,{modelValue:e.warehouse_id,"onUpdate:modelValue":[l=>e.warehouse_id=l,e=>a("warehouse_id")],label:"Kho hàng",name:"warehouse_id",type:"select",options:w.value,error:l.warehouse_id,required:""},null,8,["modelValue","onUpdate:modelValue","options","error"])]),n(s,{modelValue:e.quantity,"onUpdate:modelValue":[l=>e.quantity=l,e=>a("quantity")],label:"Số lượng",name:"quantity",type:"number",error:l.quantity,required:"",min:0},null,8,["modelValue","onUpdate:modelValue","error"]),n(s,{modelValue:e.reserved_quantity,"onUpdate:modelValue":[l=>e.reserved_quantity=l,e=>a("reserved_quantity")],label:"Số lượng đã giữ chỗ",name:"reserved_quantity",type:"number",error:l.reserved_quantity,min:0},null,8,["modelValue","onUpdate:modelValue","error"])])]),n("div",{class:"bg-gray-50 p-6 rounded-lg"},[n("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Thông tin lô hàng"),n("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-6"},[n(s,{modelValue:e.batch_no,"onUpdate:modelValue":[l=>e.batch_no=l,e=>a("batch_no")],label:"Mã lô hàng",name:"batch_no",error:l.batch_no,placeholder:"Nhập mã lô hàng"},null,8,["modelValue","onUpdate:modelValue","error"]),n(s,{modelValue:e.lot_no,"onUpdate:modelValue":[l=>e.lot_no=l,e=>a("lot_no")],label:"Số lô sản xuất",name:"lot_no",error:l.lot_no,placeholder:"Nhập số lô sản xuất"},null,8,["modelValue","onUpdate:modelValue","error"]),n(s,{modelValue:e.expiry_date,"onUpdate:modelValue":[l=>e.expiry_date=l,e=>a("expiry_date")],label:"Hạn sử dụng",name:"expiry_date",type:"date",error:l.expiry_date},null,8,["modelValue","onUpdate:modelValue","error"]),n(s,{modelValue:e.cost_price,"onUpdate:modelValue":[l=>e.cost_price=l,e=>a("cost_price")],label:"Giá vốn",name:"cost_price",type:"number",error:l.cost_price,min:0,step:.01,placeholder:"Nhập giá vốn"},null,8,["modelValue","onUpdate:modelValue","error"])])])])]),_:1},8,["default-values","rules","api-errors","submit-text"])];l(d(u,{"default-values":b.value,rules:U.value,"api-errors":t.apiErrors,"submit-text":c.inventory?"Cập nhật":"Tạo tồn kho",onSubmit:R$1,onCancel:x,ref_key:"formWrapperRef",ref:v},{default:r(({form:e,errors:l,clearError:a,isSubmitting:o},r,t,i)=>{if(!r)return[n("div",{class:"space-y-6"},[n("div",{class:"bg-gray-50 p-6 rounded-lg"},[n("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Thông tin tồn kho"),n("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-6"},[n("div",{class:"md:col-span-2"},[n(s,{modelValue:e.product_id,"onUpdate:modelValue":[l=>e.product_id=l,l=>{a("product_id"),q(l),c.inventory||(e.variant_id="")}],label:"Sản phẩm",name:"product_id",type:"select",options:f.value,error:l.product_id,required:""},null,8,["modelValue","onUpdate:modelValue","options","error"])]),n("div",{class:"md:col-span-2"},[n(s,{modelValue:e.variant_id,"onUpdate:modelValue":[l=>e.variant_id=l,e=>a("variant_id")],label:"Biến thể sản phẩm (Tùy chọn)",name:"variant_id",type:"select",options:S.value,error:l.variant_id},null,8,["modelValue","onUpdate:modelValue","options","error"])]),n("div",{class:"md:col-span-2"},[n(s,{modelValue:e.warehouse_id,"onUpdate:modelValue":[l=>e.warehouse_id=l,e=>a("warehouse_id")],label:"Kho hàng",name:"warehouse_id",type:"select",options:w.value,error:l.warehouse_id,required:""},null,8,["modelValue","onUpdate:modelValue","options","error"])]),n(s,{modelValue:e.quantity,"onUpdate:modelValue":[l=>e.quantity=l,e=>a("quantity")],label:"Số lượng",name:"quantity",type:"number",error:l.quantity,required:"",min:0},null,8,["modelValue","onUpdate:modelValue","error"]),n(s,{modelValue:e.reserved_quantity,"onUpdate:modelValue":[l=>e.reserved_quantity=l,e=>a("reserved_quantity")],label:"Số lượng đã giữ chỗ",name:"reserved_quantity",type:"number",error:l.reserved_quantity,min:0},null,8,["modelValue","onUpdate:modelValue","error"])])]),n("div",{class:"bg-gray-50 p-6 rounded-lg"},[n("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Thông tin lô hàng"),n("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-6"},[n(s,{modelValue:e.batch_no,"onUpdate:modelValue":[l=>e.batch_no=l,e=>a("batch_no")],label:"Mã lô hàng",name:"batch_no",error:l.batch_no,placeholder:"Nhập mã lô hàng"},null,8,["modelValue","onUpdate:modelValue","error"]),n(s,{modelValue:e.lot_no,"onUpdate:modelValue":[l=>e.lot_no=l,e=>a("lot_no")],label:"Số lô sản xuất",name:"lot_no",error:l.lot_no,placeholder:"Nhập số lô sản xuất"},null,8,["modelValue","onUpdate:modelValue","error"]),n(s,{modelValue:e.expiry_date,"onUpdate:modelValue":[l=>e.expiry_date=l,e=>a("expiry_date")],label:"Hạn sử dụng",name:"expiry_date",type:"date",error:l.expiry_date},null,8,["modelValue","onUpdate:modelValue","error"]),n(s,{modelValue:e.cost_price,"onUpdate:modelValue":[l=>e.cost_price=l,e=>a("cost_price")],label:"Giá vốn",name:"cost_price",type:"number",error:l.cost_price,min:0,step:.01,placeholder:"Nhập giá vốn"},null,8,["modelValue","onUpdate:modelValue","error"])])])])];r(`<div class="space-y-6"${i}><div class="bg-gray-50 p-6 rounded-lg"${i}><h3 class="text-lg font-semibold text-gray-900 mb-4"${i}>Thông tin tồn kho</h3><div class="grid grid-cols-1 md:grid-cols-2 gap-6"${i}><div class="md:col-span-2"${i}>`),r(d(s,{modelValue:e.product_id,"onUpdate:modelValue":[l=>e.product_id=l,l=>{a("product_id"),q(l),c.inventory||(e.variant_id="")}],label:"Sản phẩm",name:"product_id",type:"select",options:f.value,error:l.product_id,required:""},null,t,i)),r(`</div><div class="md:col-span-2"${i}>`),r(d(s,{modelValue:e.variant_id,"onUpdate:modelValue":[l=>e.variant_id=l,e=>a("variant_id")],label:"Biến thể sản phẩm (Tùy chọn)",name:"variant_id",type:"select",options:S.value,error:l.variant_id},null,t,i)),r(`</div><div class="md:col-span-2"${i}>`),r(d(s,{modelValue:e.warehouse_id,"onUpdate:modelValue":[l=>e.warehouse_id=l,e=>a("warehouse_id")],label:"Kho hàng",name:"warehouse_id",type:"select",options:w.value,error:l.warehouse_id,required:""},null,t,i)),r("</div>"),r(d(s,{modelValue:e.quantity,"onUpdate:modelValue":[l=>e.quantity=l,e=>a("quantity")],label:"Số lượng",name:"quantity",type:"number",error:l.quantity,required:"",min:0},null,t,i)),r(d(s,{modelValue:e.reserved_quantity,"onUpdate:modelValue":[l=>e.reserved_quantity=l,e=>a("reserved_quantity")],label:"Số lượng đã giữ chỗ",name:"reserved_quantity",type:"number",error:l.reserved_quantity,min:0},null,t,i)),r(`</div></div><div class="bg-gray-50 p-6 rounded-lg"${i}><h3 class="text-lg font-semibold text-gray-900 mb-4"${i}>Thông tin lô hàng</h3><div class="grid grid-cols-1 md:grid-cols-2 gap-6"${i}>`),r(d(s,{modelValue:e.batch_no,"onUpdate:modelValue":[l=>e.batch_no=l,e=>a("batch_no")],label:"Mã lô hàng",name:"batch_no",error:l.batch_no,placeholder:"Nhập mã lô hàng"},null,t,i)),r(d(s,{modelValue:e.lot_no,"onUpdate:modelValue":[l=>e.lot_no=l,e=>a("lot_no")],label:"Số lô sản xuất",name:"lot_no",error:l.lot_no,placeholder:"Nhập số lô sản xuất"},null,t,i)),r(d(s,{modelValue:e.expiry_date,"onUpdate:modelValue":[l=>e.expiry_date=l,e=>a("expiry_date")],label:"Hạn sử dụng",name:"expiry_date",type:"date",error:l.expiry_date},null,t,i)),r(d(s,{modelValue:e.cost_price,"onUpdate:modelValue":[l=>e.cost_price=l,e=>a("cost_price")],label:"Giá vốn",name:"cost_price",type:"number",error:l.cost_price,min:0,step:.01,placeholder:"Nhập giá vốn"},null,t,i)),r("</div></div></div>")}),_:1},a,o))}),_:1},a))}}},c=p.setup;p.setup=(e,l)=>{const a=t();return(a.modules||(a.modules=new Set)).add("pages/admin/inventory/form.vue"),c?c(e,l):void 0};export{p as default};
