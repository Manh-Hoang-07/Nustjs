import{ref as e,mergeProps as t,unref as a,withCtx as s,createVNode as r,withDirectives as n,withKeys as o,vModelText as l,createBlock as i,openBlock as d,Fragment as c,renderList as p,toDisplayString as u,vModelSelect as m,reactive as g,computed as x,useSSRContext as h}from"vue";import{ssrRenderAttrs as y,ssrRenderComponent as f,ssrRenderAttr as b,ssrIncludeBooleanAttr as w,ssrLooseContain as v,ssrLooseEqual as $,ssrRenderList as I,ssrInterpolate as k,ssrRenderClass as A,ssrRenderSlot as _}from"vue/server-renderer";import{i as T}from"./Actions-B-4SIiXX.mjs";import{m as E}from"./ConfirmModal-CltOniOu.mjs";import{E as C}from"./useApiClient-LtAAs9ek.mjs";import{p as M}from"./endpoints-B4pxijLT.mjs";import"./Modal-CcMmmM3q.mjs";import"./_plugin-vue_export-helper-DlAUqK2U.mjs";import"axios";import"./server.mjs";import"../_/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"node:url";import"../routes/renderer.mjs";import"vue-bundle-renderer/runtime";import"unhead/server";import"devalue";import"unhead/utils";import"vue-router";const j={__name:"AdminTable",__ssrInlineRender:!0,props:{items:{type:Array,default:()=>[]},title:{type:String,default:"Danh sách dữ liệu"},showAddButton:{type:Boolean,default:!0},addButtonText:{type:String,default:"Thêm mới"},emptyText:{type:String,default:"Không có dữ liệu"},showCheckbox:{type:Boolean,default:!1},showPagination:{type:Boolean,default:!0},pagination:{type:Object,default:null},selectedItems:{type:Array,default:()=>[]},itemKey:{type:String,default:"id"}},emits:["add","edit","delete","toggle-all","toggle-item","page-change"],setup(e,{emit:a}){const s=e,r=x(()=>{let e=1;return s.showCheckbox&&(e+=1),e=s.title&&s.title.includes("Tồn kho")?7:5,e}),n=x(()=>s.items.length>0&&s.selectedItems.length===s.items.length);return(a,o,l,i)=>{o(`<div${y(t({class:"admin-table"},i))}><div class="flex justify-between items-center mb-6"><h1 class="text-2xl font-bold">${k(e.title)}</h1>`),e.showAddButton?o(`<button class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none">${k(e.addButtonText)}</button>`):o("\x3c!----\x3e"),o("</div>"),a.$slots.filters?(o('<div class="mb-6 bg-white p-4 rounded-lg shadow">'),_(a.$slots,"filters",{},null,o,l),o("</div>")):o("\x3c!----\x3e"),o('<div class="bg-white shadow-md rounded-lg overflow-hidden"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr>'),e.showCheckbox?o(`<th class="w-12 px-6 py-3"><input type="checkbox"${w(n.value)?" checked":""} class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"></th>`):o("\x3c!----\x3e"),_(a.$slots,"header",{},null,o,l),o('<th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"> Thao tác </th></tr></thead><tbody class="bg-white divide-y divide-gray-200">'),e.items.length?(o("\x3c!--[--\x3e"),I(e.items,(t,r)=>{o(`<tr class="${A({"bg-gray-50":r%2==0})}">`),e.showCheckbox?o(`<td class="px-6 py-4 whitespace-nowrap"><input type="checkbox"${w(function(e){return s.selectedItems.some(t=>t[s.itemKey]===e[s.itemKey])}(t))?" checked":""} class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"></td>`):o("\x3c!----\x3e"),_(a.$slots,"row",{item:t,index:r},null,o,l),o('<td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">'),_(a.$slots,"actions",{item:t,index:r},()=>{o(f(T,{item:t,onEdit:e=>a.$emit("edit",t),onDelete:e=>a.$emit("delete",t)},null,l))},o,l),o("</td></tr>")}),o("\x3c!--]--\x3e")):o(`<tr><td${b("colspan",r.value)} class="px-6 py-4 text-center text-gray-500">${k(e.emptyText)}</td></tr>`),o("</tbody></table></div>"),e.showPagination?(o('<div class="mt-4 flex justify-between items-center"><div class="text-sm text-gray-700">'),e.pagination?o(`<span> Hiển thị ${k(e.pagination.from||0)} đến ${k(e.pagination.to||0)} trên tổng số ${k(e.pagination.total||0)} bản ghi </span>`):o("\x3c!----\x3e"),o('</div><div class="flex space-x-1">'),_(a.$slots,"pagination",{},()=>{e.pagination&&e.pagination.links?(o("\x3c!--[--\x3e"),I(e.pagination.links,e=>{o(`<button${w(!e.url)?" disabled":""} class="${A(["px-3 py-1 border rounded",e.active?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50",!e.url&&"opacity-50 cursor-not-allowed"])}">${e.label??""}</button>`)}),o("\x3c!--]--\x3e")):o("\x3c!----\x3e")},o,l),o("</div></div>")):o("\x3c!----\x3e"),o("</div>")}}},D=j.setup;function fe(e){const t=C(),{endpoints:a,resourceName:s="dữ liệu",transformItem:r=e=>e,beforeSubmit:n=e=>e,afterFetch:o=e=>e,defaultFilters:l={},debounceTime:i=300}=e,d=g({items:[],selectedItems:[],selectedItem:null,loading:!1,apiErrors:{},pagination:{current_page:1,from:0,to:0,total:0,per_page:10,links:[]},filters:{search:"",page:1,...l},modals:{create:!1,edit:!1,delete:!1,view:!1}}),c={hasItems:x(()=>d.items.length>0),isEmpty:x(()=>!d.loading&&0===d.items.length),hasSelection:x(()=>d.selectedItems.length>0),isAllSelected:x(()=>d.items.length>0&&d.selectedItems.length===d.items.length),selectedCount:x(()=>d.selectedItems.length)};let p=null;const u={async fetchItems(e=1){d.loading=!0;try{const s={...d.filters,page:e},n=await t.get(a.list,{params:s});return n.data.data&&(d.items=n.data.data.map(r)),n.data.meta&&Object.assign(d.pagination,n.data.meta),o(n.data),n.data}catch(e){return console.error(`Error fetching ${s}:`,e),null}finally{d.loading=!1}},async createItem(e){d.loading=!0,this.clearApiErrors();try{const s=n(e),r=await t.post(a.create,s);return await this.fetchItems(d.pagination.current_page),this.closeCreateModal(),r.data}catch(e){return console.error(`Error creating ${s}:`,e),this.handleApiError(e),null}finally{d.loading=!1}},async updateItem(e){if(!d.selectedItem)return null;d.loading=!0,this.clearApiErrors();try{const s=n(e),r=await t.post(a.update(d.selectedItem.id),s);return await this.fetchItems(d.pagination.current_page),this.closeEditModal(),r.data}catch(e){return console.error(`Error updating ${s}:`,e),this.handleApiError(e),null}finally{d.loading=!1}},async deleteItem(){if(!d.selectedItem)return!1;d.loading=!0;try{return await t.delete(a.delete(d.selectedItem.id)),await this.fetchItems(d.pagination.current_page),this.closeDeleteModal(),!0}catch(e){return console.error(`Error deleting ${s}:`,e),!1}finally{d.loading=!1}},async deleteSelectedItems(){if(!d.selectedItems.length)return!1;d.loading=!0;try{return await Promise.all(d.selectedItems.map(e=>t.delete(a.delete(e.id)))),await this.fetchItems(d.pagination.current_page),d.selectedItems=[],!0}catch(e){return console.error(`Error deleting ${s}:`,e),!1}finally{d.loading=!1}}};return{...d,...c,...u,...{toggleSelectAll(){d.selectedItems.length===d.items.length?d.selectedItems=[]:d.selectedItems=[...d.items]},toggleSelectItem(e){const t=d.selectedItems.findIndex(t=>t.id===e.id);-1===t?d.selectedItems.push(e):d.selectedItems.splice(t,1)}},...{openCreateModal(){d.modals.create=!0},closeCreateModal(){d.modals.create=!1,this.clearApiErrors()},openEditModal(e){d.selectedItem=e,d.modals.edit=!0},closeEditModal(){d.modals.edit=!1,d.selectedItem=null,this.clearApiErrors()},openDeleteModal(e){d.selectedItem=e,d.modals.delete=!0},closeDeleteModal(){d.modals.delete=!1,d.selectedItem=null},openViewModal(e){d.selectedItem=e,d.modals.view=!0},closeViewModal(){d.modals.view=!1,d.selectedItem=null}},...{changePage(e){if(!e)return;const t=new URL(e).searchParams.get("page");u.fetchItems(t)},applyFilters(){var e;e=()=>{u.fetchItems(1)},p&&clearTimeout(p),p=setTimeout(e,i)},resetFilters(){Object.assign(d.filters,{search:"",page:1,...l}),u.fetchItems(1)}},...{handleApiError(e){if(422===e.response?.status&&e.response?.data?.errors){const t=e.response.data.errors;for(const e in t)Array.isArray(t[e])?d.apiErrors[e]=t[e][0]:d.apiErrors[e]=t[e]}},clearApiErrors(){Object.keys(d.apiErrors).forEach(e=>delete d.apiErrors[e])}}}}j.setup=(e,t)=>{const a=h();return(a.modules||(a.modules=new Set)).add("components/Admin/Table/AdminTable.vue"),D?D(e,t):void 0};const K={__name:"index-new",__ssrInlineRender:!0,setup(g){const x=useApiClient(),h=e([]),_=e([]),{items:T,selectedItems:C,selectedItem:D,loading:K,pagination:S,filters:V,showDeleteModal:U,deleteItem:B,toggleSelectAll:F,toggleSelectItem:N,openCreateModal:P,openEditModal:H,openDeleteModal:O,closeDeleteModal:L,changePage:R,applyFilters:q,resetFilters:G}=fe({endpoints:M.products,resourceName:"sản phẩm",transformItem:e=>({...e,thumbnail:e.thumbnail?e.thumbnail.startsWith("http")?e.thumbnail:`/storage/${e.thumbnail}`:null,category_name:e.category?e.category.name:"Không có",brand_name:e.brand?e.brand.name:"Không có"}),afterFetch:e=>{0===h.value.length&&async function(){try{const e=await x.get(M.categories.list,{params:{all:!0}});h.value=e.data.data||[]}catch{}}(),0===_.value.length&&async function(){try{const e=await x.get(M.brands.list,{params:{all:!0}});_.value=e.data.data||[]}catch{}}()}});function W(e){switch(parseInt(e)){case 1:return"Hoạt động";case 0:return"Không hoạt động";default:return"Không xác định"}}function X(e){switch(parseInt(e)){case 1:return"bg-green-100 text-green-800";case 0:return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}}return(e,g,x,M)=>{g(`<div${y(t({class:"container mx-auto p-4"},M))}>`),g(f(j,{title:"Quản lý sản phẩm",items:a(T),loading:a(K),pagination:a(S),"selected-items":a(C),"add-button-text":"Thêm sản phẩm mới",onAdd:a(P),onEdit:a(H),onDelete:a(O),onPageChange:a(R),onToggleAll:a(F),onToggleItem:a(N)},{header:s((e,t,a,s)=>{if(!t)return[r("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"ID"),r("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Hình ảnh"),r("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Tên sản phẩm"),r("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Danh mục"),r("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Thương hiệu"),r("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Giá"),r("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Trạng thái")];t(`<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"${s}>ID</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"${s}>Hình ảnh</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"${s}>Tên sản phẩm</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"${s}>Danh mục</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"${s}>Thương hiệu</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"${s}>Giá</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"${s}>Trạng thái</th>`)}),row:s(({item:e},t,a,s)=>{if(!t)return[r("td",{class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},u(e.id),1),r("td",{class:"px-6 py-4 whitespace-nowrap"},[e.thumbnail?(d(),i("img",{key:0,src:e.thumbnail,alt:"Thumbnail",class:"h-10 w-10 object-contain"},null,8,["src"])):(d(),i("span",{key:1,class:"text-gray-400"},"Không có ảnh"))]),r("td",{class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},u(e.name),1),r("td",{class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},u(e.category_name),1),r("td",{class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},u(e.brand_name),1),r("td",{class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},u(new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(e.price)),1),r("td",{class:"px-6 py-4 whitespace-nowrap"},[r("span",{class:["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",X(e.status)]},u(W(e.status)),3)])];t(`<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"${s}>${k(e.id)}</td><td class="px-6 py-4 whitespace-nowrap"${s}>`),e.thumbnail?t(`<img${b("src",e.thumbnail)} alt="Thumbnail" class="h-10 w-10 object-contain"${s}>`):t(`<span class="text-gray-400"${s}>Không có ảnh</span>`),t(`</td><td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"${s}>${k(e.name)}</td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"${s}>${k(e.category_name)}</td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"${s}>${k(e.brand_name)}</td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"${s}>${k(new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(e.price))}</td><td class="px-6 py-4 whitespace-nowrap"${s}><span class="${A([X(e.status),"px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])}"${s}>${k(W(e.status))}</span></td>`)}),filters:s((e,t,s,g)=>{if(!t)return[r("div",{class:"flex flex-wrap gap-4"},[r("div",{class:"flex-1"},[r("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tìm kiếm"),n(r("input",{"onUpdate:modelValue":e=>a(V).search=e,type:"text",placeholder:"Tìm theo tên sản phẩm",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",onKeyup:o(a(q),["enter"])},null,40,["onUpdate:modelValue","onKeyup"]),[[l,a(V).search]])]),r("div",{class:"flex-1"},[r("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Danh mục"),n(r("select",{"onUpdate:modelValue":e=>a(V).category_id=e,class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"},[r("option",{value:""},"Tất cả danh mục"),(d(!0),i(c,null,p(h.value,e=>(d(),i("option",{key:e.id,value:e.id},u(e.name),9,["value"]))),128))],8,["onUpdate:modelValue"]),[[m,a(V).category_id]])]),r("div",{class:"flex-1"},[r("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Thương hiệu"),n(r("select",{"onUpdate:modelValue":e=>a(V).brand_id=e,class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"},[r("option",{value:""},"Tất cả thương hiệu"),(d(!0),i(c,null,p(_.value,e=>(d(),i("option",{key:e.id,value:e.id},u(e.name),9,["value"]))),128))],8,["onUpdate:modelValue"]),[[m,a(V).brand_id]])]),r("div",{class:"flex-1"},[r("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Trạng thái"),n(r("select",{"onUpdate:modelValue":e=>a(V).status=e,class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"},[r("option",{value:""},"Tất cả trạng thái"),r("option",{value:"1"},"Hoạt động"),r("option",{value:"0"},"Không hoạt động")],8,["onUpdate:modelValue"]),[[m,a(V).status]])]),r("div",{class:"flex-none self-end"},[r("button",{onClick:a(q),class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none mr-2"}," Lọc ",8,["onClick"]),r("button",{onClick:a(G),class:"px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 focus:outline-none"}," Đặt lại ",8,["onClick"])])])];t(`<div class="flex flex-wrap gap-4"${g}><div class="flex-1"${g}><label class="block text-sm font-medium text-gray-700 mb-1"${g}>Tìm kiếm</label><input${b("value",a(V).search)} type="text" placeholder="Tìm theo tên sản phẩm" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"${g}></div><div class="flex-1"${g}><label class="block text-sm font-medium text-gray-700 mb-1"${g}>Danh mục</label><select class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"${g}><option value=""${w(Array.isArray(a(V).category_id)?v(a(V).category_id,""):$(a(V).category_id,""))?" selected":""}${g}>Tất cả danh mục</option>\x3c!--[--\x3e`),I(h.value,e=>{t(`<option${b("value",e.id)}${w(Array.isArray(a(V).category_id)?v(a(V).category_id,e.id):$(a(V).category_id,e.id))?" selected":""}${g}>${k(e.name)}</option>`)}),t(`\x3c!--]--\x3e</select></div><div class="flex-1"${g}><label class="block text-sm font-medium text-gray-700 mb-1"${g}>Thương hiệu</label><select class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"${g}><option value=""${w(Array.isArray(a(V).brand_id)?v(a(V).brand_id,""):$(a(V).brand_id,""))?" selected":""}${g}>Tất cả thương hiệu</option>\x3c!--[--\x3e`),I(_.value,e=>{t(`<option${b("value",e.id)}${w(Array.isArray(a(V).brand_id)?v(a(V).brand_id,e.id):$(a(V).brand_id,e.id))?" selected":""}${g}>${k(e.name)}</option>`)}),t(`\x3c!--]--\x3e</select></div><div class="flex-1"${g}><label class="block text-sm font-medium text-gray-700 mb-1"${g}>Trạng thái</label><select class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"${g}><option value=""${w(Array.isArray(a(V).status)?v(a(V).status,""):$(a(V).status,""))?" selected":""}${g}>Tất cả trạng thái</option><option value="1"${w(Array.isArray(a(V).status)?v(a(V).status,"1"):$(a(V).status,"1"))?" selected":""}${g}>Hoạt động</option><option value="0"${w(Array.isArray(a(V).status)?v(a(V).status,"0"):$(a(V).status,"0"))?" selected":""}${g}>Không hoạt động</option></select></div><div class="flex-none self-end"${g}><button class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none mr-2"${g}> Lọc </button><button class="px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 focus:outline-none"${g}> Đặt lại </button></div></div>`)}),_:1},x)),a(U)?g(f(E,{show:a(U),title:"Xác nhận xóa",message:`Bạn có chắc chắn muốn xóa sản phẩm ${a(D)?.name||""}?`,"on-close":a(L),onConfirm:a(B)},null,x)):g("\x3c!----\x3e"),g("</div>")}}},S=K.setup;K.setup=(e,t)=>{const a=h();return(a.modules||(a.modules=new Set)).add("pages/admin/products/index-new.vue"),S?S(e,t):void 0};export{K as default};
