import{reactive as e,ref as t,computed as r,watch as n,mergeProps as a,useSSRContext as s}from"vue";import{ssrRenderAttrs as i,ssrRenderSlot as o,ssrInterpolate as l,ssrIncludeBooleanAttr as u}from"vue/server-renderer";function v(e,t){const r={};for(const n in t){const a=e&&void 0!==e[n]&&null!==e[n]?e[n]:"";let s;s="password"===n?a.toString():a.toString().trim();for(const a of t[n])if("string"==typeof a){if("required"===a&&!s){r[n]="Trường này là bắt buộc.";break}if("email"===a&&s&&!/^\S+@\S+\.\S+$/.test(s)){r[n]="Email không hợp lệ.";break}}else if("object"==typeof a)for(const t in a){const i=a[t];if("required"===t&&!s){r[n]=i;break}if("email"===t&&s&&!/^\S+@\S+\.\S+$/.test(s)){r[n]=i;break}if("min"===t&&s){const[e,t]=Array.isArray(i)?i:[i,`Tối thiểu ${i} ký tự.`];if(s.length<e){r[n]=t;break}}if("match"===t&&s){const[t,a]=Array.isArray(i)?i:[i,"Giá trị xác nhận không khớp."],o=e&&void 0!==e[t]&&null!==e[t]?e[t]:"";if(s!==("password"===t?o.toString():o.toString().trim())){r[n]=a;break}}if("pattern"===t&&s){const[e,t]=Array.isArray(i)?i:[i,"Định dạng không hợp lệ."];if(!e.test(s)){r[n]=t;break}}}}return r}const d={__name:"CoreFormWrapper",__ssrInlineRender:!0,props:{initialData:{type:Object,default:()=>({})},defaultValues:{type:Object,default:()=>({})},rules:{type:Object,default:()=>({})},apiErrors:{type:Object,default:()=>({})},showCancelButton:{type:Boolean,default:!0},submitText:{type:String,default:"Lưu"},submittingText:{type:String,default:"Đang lưu..."},cancelText:{type:String,default:"Hủy"},disableSubmit:{type:Boolean,default:!1}},emits:["submit","cancel","error"],setup(s,{expose:d,emit:f}){const p=s,b=f,y=e({...p.defaultValues,...p.initialData}),g=e({}),h=t(!1),x=r(()=>({...g,...p.apiErrors}));function c(e){delete g[e]}function m(){if(Object.keys(g).forEach(e=>delete g[e]),!p.rules||0===Object.keys(p.rules).length)return!0;const e=v(y,p.rules);return!(Object.keys(e).length>0)||(Object.assign(g,e),b("error",e),!1)}async function k(){if(!h.value&&m()){h.value=!0;try{b("submit",{...y})}finally{h.value=!1}}}function E(){b("cancel")}return n(()=>p.defaultValues,e=>{Object.keys(e).forEach(t=>{t in y&&(y[t]=e[t])})},{deep:!0}),n(()=>p.initialData,e=>{e&&Object.keys(e).length>0&&Object.keys(y).forEach(t=>{t in e&&(y[t]=e[t])})},{deep:!0}),d({updateForm:e=>{Object.keys(e).forEach(t=>{t in y&&(y[t]=e[t])})},form:y,validate:()=>v(y,p.rules)}),(e,t,r,n)=>{t(`<div${i(a({class:"form-wrapper"},n))}>`),o(e.$slots,"default",{form:y,errors:x.value,isSubmitting:h.value,clearError:c,validate:m},null,t,r),t('<div class="mt-4 flex justify-end space-x-2">'),o(e.$slots,"actions",{submit:k,cancel:E},()=>{s.showCancelButton?t(`<button type="button" class="px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none">${l(s.cancelText)}</button>`):t("\x3c!----\x3e"),t(`<button type="submit" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none"${u(h.value||s.disableSubmit)?" disabled":""}>`),h.value?t(`<span><span class="inline-block animate-spin mr-2">↻</span> ${l(s.submittingText)}</span>`):t(`<span>${l(s.submitText)}</span>`),t("</button>")},t,r),t("</div></div>")}}},f=d.setup;d.setup=(e,t)=>{const r=s();return(r.modules||(r.modules=new Set)).add("components/Core/Form/FormWrapper.vue"),f?f(e,t):void 0};export{d as j};
