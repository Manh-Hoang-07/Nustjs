import{computed as t,ref as e,reactive as a,mergeProps as s,unref as r,useSSRContext as o}from"vue";import{ssrRenderAttrs as n,ssrInterpolate as i,ssrRenderClass as d,ssrIncludeBooleanAttr as l,ssrRenderComponent as u,ssrRenderList as c,ssrRenderAttr as p}from"vue/server-renderer";import{useRoute as m}from"vue-router";import v from"./form-DR-rgvXH.mjs";import h from"./variant-form-CjZDgT4w.mjs";import x from"./image-form-D9X_cjVq.mjs";import{p as g}from"./endpoints-B4pxijLT.mjs";import{n as b}from"./formatCurrency-CNGtvvPC.mjs";import{E as f}from"./useApiClient-LtAAs9ek.mjs";import"./Modal-CcMmmM3q.mjs";import"./_plugin-vue_export-helper-DlAUqK2U.mjs";import"./FormWrapper-BkWXOK5b.mjs";import"./FormField-C25kxm9c.mjs";import"./debounce-CONOwAJH.mjs";import"./apiClient-CZcLLw7q.mjs";import"axios";import"./ImageUploader-CkuS8dvw.mjs";import"./server.mjs";import"../_/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"node:url";import"../routes/renderer.mjs";import"vue-bundle-renderer/runtime";import"unhead/server";import"devalue";import"unhead/utils";const j={__name:"edit-page",__ssrInlineRender:!0,setup(o){const j=f(),k=m(),$=t(()=>k.params.id),C=e("basic"),_=e(null),L=e([]),A=e([]),T=e(!1),B=a({}),K=e({}),U=e(!1),q=e(!1),X=e(null),D=e(null),N=t(()=>L.value.length),O=t(()=>A.value.length);async function M(){try{const t=await j.get(`/api/admin/products/${$.value}/variants`);L.value=t.data.data||[]}catch{}}async function S(){try{const t=await j.get(`/api/admin/products/${$.value}/images`);A.value=t.data.data||[]}catch{}}async function H(t){T.value=!0;try{Object.keys(B).forEach(t=>delete B[t]);const e={...t,_method:"PUT"};await j.post(g.products.update($.value),e),await async function(){try{const t=await j.get(g.products.update($.value));_.value=t.data}catch{}}()}catch(t){if(422===t.response?.status&&t.response?.data?.errors){const e=t.response.data.errors;for(const t in e)Array.isArray(e[t])?B[t]=e[t][0]:B[t]=e[t]}}finally{T.value=!1}}function y(){U.value=!1,X.value=null}async function P(){await M(),y()}async function Q(){await M(),y()}function w(){q.value=!1,D.value=null}async function z(){await S(),w()}async function E$1(){await S(),w()}return(t,e,a,o)=>{e(`<div${n(s({class:"container mx-auto p-4"},o))}><div class="flex justify-between items-center mb-6"><div><h1 class="text-2xl font-bold">Chỉnh sửa sản phẩm</h1><p class="text-gray-600 mt-1">${i(_.value?.name)}</p></div><div class="flex space-x-3"><button class="px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 focus:outline-none"> Quay lại danh sách </button><button class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none"${l(T.value)?" disabled":""}>${i(T.value?"Đang lưu...":"Lưu thay đổi")}</button></div></div><div class="mb-6"><nav class="flex space-x-8"><button class="${d(["py-2 px-1 border-b-2 font-medium text-sm","basic"===C.value?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}"> Thông tin cơ bản </button><button class="${d(["py-2 px-1 border-b-2 font-medium text-sm","variants"===C.value?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}"> Biến thể (${i(N.value)}) </button><button class="${d(["py-2 px-1 border-b-2 font-medium text-sm","images"===C.value?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}"> Ảnh sản phẩm (${i(O.value)}) </button></nav></div>`),"basic"===C.value?(e('<div class="bg-white rounded-lg shadow p-6">'),e(u(v,{show:!0,product:_.value,"api-errors":B,"status-options":K.value,onSubmit:H,onCancel:()=>{}},null,a)),e("</div>")):"variants"===C.value?(e('<div class="bg-white rounded-lg shadow"><div class="p-6 border-b"><div class="flex justify-between items-center"><h2 class="text-lg font-medium">Quản lý biến thể sản phẩm</h2><button class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none"> Thêm biến thể mới </button></div></div><div class="overflow-x-auto"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">SKU</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ảnh</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Giá</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Số lượng</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Trạng thái</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Thao tác</th></tr></thead><tbody class="bg-white divide-y divide-gray-200">\x3c!--[--\x3e'),c(L.value,t=>{e(`<tr><td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${i(t.sku)}</td><td class="px-6 py-4 whitespace-nowrap">`),t.image?e(`<img${p("src",t.image)}${p("alt",t.sku)} class="h-10 w-10 rounded-lg object-cover">`):e('<div class="h-10 w-10 rounded-lg bg-gray-200 flex items-center justify-center"><span class="text-gray-400 text-xs">No img</span></div>'),e(`</td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${i(r(b)(t.price))}</td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${i(t.quantity)}</td><td class="px-6 py-4 whitespace-nowrap"><span class="${d(["active"===t.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800","px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])}">${i(function(t){return"active"===t?"Đang bán":"inactive"===t?"Ngừng bán":t}(t.status))}</span></td><td class="px-6 py-4 whitespace-nowrap text-sm font-medium"><button class="text-indigo-600 hover:text-indigo-900 mr-3">Sửa</button><button class="text-red-600 hover:text-red-900">Xóa</button></td></tr>`)}),e("\x3c!--]--\x3e"),0===L.value.length?e('<tr><td colspan="6" class="px-6 py-4 text-center text-gray-500"> Không có biến thể nào </td></tr>'):e("\x3c!----\x3e"),e("</tbody></table></div></div>")):"images"===C.value?(e('<div class="bg-white rounded-lg shadow"><div class="p-6 border-b"><div class="flex justify-between items-center"><h2 class="text-lg font-medium">Quản lý ảnh sản phẩm</h2><button class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none"> Thêm ảnh mới </button></div></div><div class="p-6"><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">\x3c!--[--\x3e'),c(A.value,t=>{e(`<div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-200"><div class="relative"><img${p("src",t.url)}${p("alt",t.alt_text||"Product image")} class="w-full h-48 object-cover"><div class="absolute top-2 right-2 flex space-x-1"><button class="p-1 bg-blue-500 text-white rounded-full hover:bg-blue-600 focus:outline-none" title="Chỉnh sửa"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg></button><button class="p-1 bg-red-500 text-white rounded-full hover:bg-red-600 focus:outline-none" title="Xóa"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button></div></div><div class="p-4"><h3 class="font-medium text-gray-900 mb-1">${i(t.alt_text||"Không có mô tả")}</h3><p class="text-sm text-gray-500">${i(t.caption||"Không có chú thích")}</p></div></div>`)}),e("\x3c!--]--\x3e</div>"),0===A.value.length?e('<div class="text-center py-12"><svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg><h3 class="mt-2 text-sm font-medium text-gray-900">Không có ảnh nào</h3><p class="mt-1 text-sm text-gray-500">Bắt đầu bằng cách thêm ảnh mới cho sản phẩm.</p></div>'):e("\x3c!----\x3e"),e("</div></div>")):e("\x3c!----\x3e"),U.value?e(u(h,{show:U.value,variant:X.value,"product-id":$.value,"on-close":y,onCreated:P,onUpdated:Q},null,a)):e("\x3c!----\x3e"),q.value?e(u(x,{show:q.value,image:D.value,"product-id":$.value,"on-close":w,onCreated:z,onUpdated:E$1},null,a)):e("\x3c!----\x3e"),e("</div>")}}},k=j.setup;j.setup=(t,e)=>{const a=o();return(a.modules||(a.modules=new Set)).add("pages/admin/products/edit-page.vue"),k?k(t,e):void 0};export{j as default};
