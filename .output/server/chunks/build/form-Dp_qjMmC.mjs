import{computed as e,ref as t,watch as a,mergeProps as l,withCtx as o,unref as r,createTextVNode as n,createVNode as d,createBlock as i,createCommentVNode as u,openBlock as m,toDisplayString as s,nextTick as c,useSSRContext as p}from"vue";import{ssrRenderComponent as h,ssrInterpolate as v,ssrRenderAttrs as g}from"vue/server-renderer";import{R as b}from"./Modal-CcMmmM3q.mjs";import{j as f}from"./FormWrapper-BkWXOK5b.mjs";import{$ as V}from"./FormField-C25kxm9c.mjs";import{m as y}from"./useFormDefaults-CTfnk28m.mjs";import{i as _}from"./useUrl-CNWGMiP9.mjs";import{u as x}from"./ImageUploader-CkuS8dvw.mjs";import{s as C}from"./_plugin-vue_export-helper-DlAUqK2U.mjs";import{E as U}from"./useApiClient-LtAAs9ek.mjs";import"axios";import"./server.mjs";import"../_/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"node:url";import"../routes/renderer.mjs";import"vue-bundle-renderer/runtime";import"unhead/server";import"devalue";import"unhead/utils";import"vue-router";const k={__name:"CoreContentCKEditorUltimate",__ssrInlineRender:!0,props:{modelValue:{type:String,default:""},placeholder:{type:String,default:"Nhập nội dung..."},height:{type:String,default:"400px"},disabled:{type:Boolean,default:!1},config:{type:Object,default:()=>({})}},emits:["update:modelValue","ready","change"],setup(e,{expose:o,emit:r}){const n=e,d=r,i=t(null),u=t(null),m=t(!0),s=t(null),T=async()=>{try{if(m.value=!0,s.value=null,!CKEditor&&!await(async()=>{try{return!!CKEditor}catch(e){return s.value="Không thể tải trình soạn thảo",console.error("CKEditor load error:",e),!1}})())return void(s.value="Không thể tải trình soạn thảo");if(!i.value)return void(s.value="Container không tồn tại");if(!CKEditor.create)return s.value="CKEditor không được khởi tạo đúng cách",void console.error("CKEditor object:",CKEditor);const e={placeholder:n.placeholder,toolbar:{items:["heading","|","bold","italic","underline","strikethrough","|","fontSize","fontFamily","fontColor","fontBackgroundColor","|","alignment","|","numberedList","bulletedList","|","indent","outdent","|","link","blockQuote","insertTable","mediaEmbed","|","undo","redo"]},table:{contentToolbar:["tableColumn","tableRow","mergeTableCells"]},mediaEmbed:{previewsInData:!0},...n.config};u.value=await CKEditor.create(i.value,e),n.modelValue&&u.value.setData(n.modelValue),u.value.model.document.on("change:data",()=>{const e=u.value.getData();d("update:modelValue",e),d("change",e)}),d("ready",u.value),n.disabled&&(u.value.isReadOnly=!0)}catch(e){s.value="Lỗi khởi tạo trình soạn thảo",console.error("Editor init error:",e)}finally{m.value=!1}};a(()=>n.modelValue,e=>{u.value&&e!==u.value.getData()&&u.value.setData(e||"")},{immediate:!1}),a(()=>n.disabled,e=>{u.value&&(u.value.isReadOnly=e)}),a(()=>n.config,()=>{u.value&&($(),c(()=>{T()}))},{deep:!0}),t(!1),t(null);const $=async()=>{if(u.value){try{await u.value.destroy()}catch(e){console.error("CKEditor destroy error:",e)}u.value=null}};return o({editor:()=>u.value,getData:()=>u.value?.getData()||"",setData:e=>u.value?.setData(e),isReadOnly:e=>{u.value&&(u.value.isReadOnly=e)}}),(t,a,o,r)=>{const n={style:{":--1198e2d9":e.height}};a(`<div${g(l({class:"ckeditor-container"},r,n))} data-v-7c2908cd>`),m.value?a('<div class="flex items-center justify-center p-8 border-2 border-dashed border-gray-300 rounded-lg" data-v-7c2908cd><div class="text-center" data-v-7c2908cd><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2" data-v-7c2908cd></div><p class="text-gray-600" data-v-7c2908cd>Đang tải trình soạn thảo...</p></div></div>'):(a('<div data-v-7c2908cd><div class="editor-container" data-v-7c2908cd></div>'),s.value?a(`<div class="mt-2 text-red-600 text-sm" data-v-7c2908cd>${v(s.value)}</div>`):a("\x3c!----\x3e"),a("</div>")),a("</div>")}}},E=k.setup;k.setup=(e,t)=>{const a=p();return(a.modules||(a.modules=new Set)).add("components/Core/Content/CKEditorUltimate.vue"),E?E(e,t):void 0};const D=C(k,[["__scopeId","data-v-7c2908cd"]]),K={__name:"form",__ssrInlineRender:!0,props:{show:Boolean,category:Object,parentCategories:{type:Array,default:()=>[]},statusEnums:{type:Array,default:()=>[]},apiErrors:{type:Object,default:()=>({})},loading:{type:Boolean,default:!1}},emits:["submit","cancel"],setup(c,{emit:p}){U();const g=c,C=p,k=e(()=>g.category?"Chỉnh sửa danh mục":"Thêm danh mục mới"),E=e({get:()=>g.show,set:()=>$$1()}),K=y(g,"category",{name:"",parent_id:"",slug:"",description:"",status:"",image:null,remove_image:!1}),j=t(null);a(()=>g.category,e=>{j.value=null},{immediate:!0});const S=e(()=>({name:[{required:"Tên danh mục là bắt buộc."},{max:[100,"Tên danh mục không được vượt quá 100 ký tự."]}],description:[{max:[2e3,"Mô tả không được vượt quá 2000 ký tự."]}],parent_id:[{notSelf:["Danh mục không thể là danh mục cha của chính nó."]}]}));function T(e){C("submit",e)}function $$1(){C("cancel")}const w=e(()=>{const e=[{value:"",label:"Không có (Danh mục gốc)"}];return Array.isArray(g.parentCategories)&&e.push(...g.parentCategories.map(e=>({value:e.id,label:e.name}))),e}),q=e(()=>(g.statusEnums||[]).map(e=>({value:e.value,label:e.label}))),A=_(g,"category","image");return(e,t,a,p)=>{t(h(b,l({modelValue:E.value,"onUpdate:modelValue":e=>E.value=e,title:k.value,loading:c.loading},p),{default:o((e,t,a,l)=>{if(!t)return[d(f,{"default-values":r(K),rules:S.value,"api-errors":c.apiErrors,"submit-text":c.category?"Cập nhật":"Thêm mới",onSubmit:T,onCancel:$$1},{default:o(({form:e,errors:t,clearError:a,isSubmitting:l})=>[d(V,{modelValue:e.name,"onUpdate:modelValue":[t=>e.name=t,e=>a("name")],label:"Tên danh mục",name:"name",error:t.name,required:"",autocomplete:"name"},null,8,["modelValue","onUpdate:modelValue","error"]),d(V,{modelValue:e.parent_id,"onUpdate:modelValue":[t=>e.parent_id=t,e=>a("parent_id")],label:"Danh mục cha",name:"parent_id",type:"select",options:w.value,error:t.parent_id},{help:o(()=>[n("Không có (Danh mục gốc)")]),_:2},1032,["modelValue","onUpdate:modelValue","options","error"]),d(D,{modelValue:e.description,"onUpdate:modelValue":[t=>e.description=t,e=>a("description")],label:"Mô tả chi tiết",error:t.description,placeholder:"Nhập mô tả chi tiết cho danh mục với đầy đủ tính năng định dạng...",height:"400px"},null,8,["modelValue","onUpdate:modelValue","error"]),d("div",null,[d("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Hình ảnh"),d(x,{modelValue:e.image,"onUpdate:modelValue":t=>e.image=t,"default-url":r(A)},null,8,["modelValue","onUpdate:modelValue","default-url"]),t.image?(m(),i("div",{key:0,class:"text-red-500 text-sm mt-1"},s(t.image),1)):u("",!0)]),d(V,{modelValue:e.status,"onUpdate:modelValue":[t=>e.status=t,e=>a("status")],label:"Trạng thái",name:"status",type:"select",options:q.value,error:t.status},null,8,["modelValue","onUpdate:modelValue","options","error"])]),_:1},8,["default-values","rules","api-errors","submit-text"])];t(h(f,{"default-values":r(K),rules:S.value,"api-errors":c.apiErrors,"submit-text":c.category?"Cập nhật":"Thêm mới",onSubmit:T,onCancel:$$1},{default:o(({form:e,errors:t,clearError:a,isSubmitting:l},c,p,g)=>{if(!c)return[d(V,{modelValue:e.name,"onUpdate:modelValue":[t=>e.name=t,e=>a("name")],label:"Tên danh mục",name:"name",error:t.name,required:"",autocomplete:"name"},null,8,["modelValue","onUpdate:modelValue","error"]),d(V,{modelValue:e.parent_id,"onUpdate:modelValue":[t=>e.parent_id=t,e=>a("parent_id")],label:"Danh mục cha",name:"parent_id",type:"select",options:w.value,error:t.parent_id},{help:o(()=>[n("Không có (Danh mục gốc)")]),_:2},1032,["modelValue","onUpdate:modelValue","options","error"]),d(D,{modelValue:e.description,"onUpdate:modelValue":[t=>e.description=t,e=>a("description")],label:"Mô tả chi tiết",error:t.description,placeholder:"Nhập mô tả chi tiết cho danh mục với đầy đủ tính năng định dạng...",height:"400px"},null,8,["modelValue","onUpdate:modelValue","error"]),d("div",null,[d("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Hình ảnh"),d(x,{modelValue:e.image,"onUpdate:modelValue":t=>e.image=t,"default-url":r(A)},null,8,["modelValue","onUpdate:modelValue","default-url"]),t.image?(m(),i("div",{key:0,class:"text-red-500 text-sm mt-1"},s(t.image),1)):u("",!0)]),d(V,{modelValue:e.status,"onUpdate:modelValue":[t=>e.status=t,e=>a("status")],label:"Trạng thái",name:"status",type:"select",options:q.value,error:t.status},null,8,["modelValue","onUpdate:modelValue","options","error"])];c(h(V,{modelValue:e.name,"onUpdate:modelValue":[t=>e.name=t,e=>a("name")],label:"Tên danh mục",name:"name",error:t.name,required:"",autocomplete:"name"},null,p,g)),c(h(V,{modelValue:e.parent_id,"onUpdate:modelValue":[t=>e.parent_id=t,e=>a("parent_id")],label:"Danh mục cha",name:"parent_id",type:"select",options:w.value,error:t.parent_id},{help:o((e,t,a,l)=>{if(!t)return[n("Không có (Danh mục gốc)")];t("Không có (Danh mục gốc)")}),_:2},p,g)),c(h(D,{modelValue:e.description,"onUpdate:modelValue":[t=>e.description=t,e=>a("description")],label:"Mô tả chi tiết",error:t.description,placeholder:"Nhập mô tả chi tiết cho danh mục với đầy đủ tính năng định dạng...",height:"400px"},null,p,g)),c(`<div${g}><label class="block text-sm font-medium text-gray-700 mb-1"${g}>Hình ảnh</label>`),c(h(x,{modelValue:e.image,"onUpdate:modelValue":t=>e.image=t,"default-url":r(A)},null,p,g)),t.image?c(`<div class="text-red-500 text-sm mt-1"${g}>${v(t.image)}</div>`):c("\x3c!----\x3e"),c("</div>"),c(h(V,{modelValue:e.status,"onUpdate:modelValue":[t=>e.status=t,e=>a("status")],label:"Trạng thái",name:"status",type:"select",options:q.value,error:t.status},null,p,g))}),_:1},a,l))}),_:1},a))}}},j=K.setup;K.setup=(e,t)=>{const a=p();return(a.modules||(a.modules=new Set)).add("pages/admin/categories/form.vue"),j?j(e,t):void 0};export{K as default};
