import{ref as e,computed as r,reactive as t,watch as s,mergeProps as a,withCtx as o,createVNode as n,resolveDynamicComponent as d,withModifiers as i,withDirectives as l,createBlock as m,createCommentVNode as p,createTextVNode as u,vModelText as c,openBlock as b,toDisplayString as x,Fragment as y,renderList as g,vModelSelect as f,useSSRContext as v}from"vue";import{ssrRenderComponent as _,ssrRenderAttr as $,ssrRenderClass as h,ssrInterpolate as E,ssrIncludeBooleanAttr as k,ssrLooseContain as w,ssrLooseEqual as V,ssrRenderList as U,ssrRenderVNode as A}from"vue/server-renderer";import{R as j}from"./Modal-CcMmmM3q.mjs";import{E as T}from"./useApiClient-LtAAs9ek.mjs";import{b as q}from"./server.mjs";import"./_plugin-vue_export-helper-DlAUqK2U.mjs";import"axios";import"../_/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"node:url";import"../routes/renderer.mjs";import"vue-bundle-renderer/runtime";import"unhead/server";import"devalue";import"unhead/utils";import"vue-router";const C={__name:"form",__ssrInlineRender:!0,props:{show:Boolean,role:Object,statusEnums:{type:Array,default:()=>[]},apiErrors:{type:Object,default:()=>({})}},emits:["submit","cancel"],setup(v,{emit:C}){T();const{$loadMultiselect:M}=q(),I=e(null),K=e(!1),O=v,G=C,H=r(()=>{const e={};return Array.isArray(O.statusEnums)&&O.statusEnums.forEach(r=>{e[r.value]=r.label}),e}),Q=r(()=>S.value.map(e=>({value:e.id,label:e.display_name||e.name}))),R=e([]),S=e([]),D=e(!1),L=r(()=>O.role?"Chỉnh sửa vai trò":"Thêm vai trò mới"),z=r({get:()=>O.show,set:()=>F()}),J=t({name:"",display_name:"",guard_name:"",parent_id:"",status:"active",permissions:[]}),P=t({}),W=e(!1);function N(){Object.keys(P).forEach(e=>delete P[e])}s(()=>O.role,e=>{e?(J.name=e.name||"",J.display_name=e.display_name||"",J.guard_name=e.guard_name||"",J.parent_id=e.parent_id||"",J.status=e.status||"active",e.permissions&&Array.isArray(e.permissions)?J.permissions=e.permissions.map(e=>({value:e.id||e,label:e.display_name||e.name})):J.permissions=[]):(J.name="",J.display_name="",J.guard_name="",J.parent_id="",J.status="active",J.permissions=[],N())},{immediate:!0});const X=r(()=>({name:[{required:"Tên vai trò là bắt buộc"}],display_name:[{required:"Tên hiển thị là bắt buộc"}]}));function te(){if(function(){N();let e=!0;const r=X.value;for(const t in r)for(const s of r[t])if(s.required&&!J[t]){P[t]=s.required,e=!1;break}return e}()){W.value=!0;try{const e={name:J.name,display_name:J.display_name,guard_name:J.guard_name,parent_id:J.parent_id||null,status:J.status,permissions:[]};J.permissions&&J.permissions.length>0&&(e.permissions=J.permissions.map(e=>"object"==typeof e?e.value:e)),G("submit",e)}finally{W.value=!1}}}function B(e){J.permissions=e||[]}function F(){G("cancel")}return(e,r,t,s)=>{r(_(j,a({modelValue:z.value,"onUpdate:modelValue":e=>z.value=e,title:L.value},s),{default:o((e,r,t,s)=>{if(!r)return[n("form",{onSubmit:i(te,["prevent"]),class:"space-y-4"},[n("div",null,[n("label",{for:"name",class:"block text-sm font-medium text-gray-700 mb-1"},[u("Tên vai trò "),n("span",{class:"text-red-500"},"*")]),l(n("input",{id:"name","onUpdate:modelValue":e=>J.name=e,type:"text",class:["w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",{"border-red-500":P.name||v.apiErrors.name}]},null,10,["onUpdate:modelValue"]),[[c,J.name]]),P.name?(b(),m("p",{key:0,class:"mt-1 text-sm text-red-600"},x(P.name),1)):v.apiErrors.name?(b(),m("p",{key:1,class:"mt-1 text-sm text-red-600"},x(v.apiErrors.name),1)):p("",!0)]),n("div",null,[n("label",{for:"display_name",class:"block text-sm font-medium text-gray-700 mb-1"},"Tên hiển thị"),l(n("input",{id:"display_name","onUpdate:modelValue":e=>J.display_name=e,type:"text",class:["w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",{"border-red-500":P.display_name||v.apiErrors.display_name}]},null,10,["onUpdate:modelValue"]),[[c,J.display_name]]),P.display_name?(b(),m("p",{key:0,class:"mt-1 text-sm text-red-600"},x(P.display_name),1)):v.apiErrors.display_name?(b(),m("p",{key:1,class:"mt-1 text-sm text-red-600"},x(v.apiErrors.display_name),1)):p("",!0)]),n("div",null,[n("label",{for:"guard_name",class:"block text-sm font-medium text-gray-700 mb-1"},"Guard"),l(n("input",{id:"guard_name","onUpdate:modelValue":e=>J.guard_name=e,type:"text",class:["w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",{"border-red-500":P.guard_name||v.apiErrors.guard_name}]},null,10,["onUpdate:modelValue"]),[[c,J.guard_name]]),P.guard_name?(b(),m("p",{key:0,class:"mt-1 text-sm text-red-600"},x(P.guard_name),1)):v.apiErrors.guard_name?(b(),m("p",{key:1,class:"mt-1 text-sm text-red-600"},x(v.apiErrors.guard_name),1)):p("",!0)]),n("div",null,[n("label",{for:"parent_id",class:"block text-sm font-medium text-gray-700 mb-1"},"Vai trò cha"),l(n("select",{id:"parent_id","onUpdate:modelValue":e=>J.parent_id=e,class:["w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",{"border-red-500":P.parent_id||v.apiErrors.parent_id}]},[n("option",{value:""},"-- Không có --"),(b(!0),m(y,null,g(R.value,e=>(b(),m("option",{key:e.id,value:e.id},x(e.display_name||e.name),9,["value"]))),128))],10,["onUpdate:modelValue"]),[[f,J.parent_id]]),P.parent_id?(b(),m("p",{key:0,class:"mt-1 text-sm text-red-600"},x(P.parent_id),1)):v.apiErrors.parent_id?(b(),m("p",{key:1,class:"mt-1 text-sm text-red-600"},x(v.apiErrors.parent_id),1)):p("",!0)]),n("div",null,[n("label",{for:"status",class:"block text-sm font-medium text-gray-700 mb-1"},"Trạng thái"),l(n("select",{id:"status","onUpdate:modelValue":e=>J.status=e,class:["w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",{"border-red-500":P.status||v.apiErrors.status}]},[(b(!0),m(y,null,g(H.value,(e,r)=>(b(),m("option",{key:r,value:r},x(e),9,["value"]))),128))],10,["onUpdate:modelValue"]),[[f,J.status]]),P.status?(b(),m("p",{key:0,class:"mt-1 text-sm text-red-600"},x(P.status),1)):v.apiErrors.status?(b(),m("p",{key:1,class:"mt-1 text-sm text-red-600"},x(v.apiErrors.status),1)):p("",!0)]),n("div",null,[n("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Quyền"),D.value?(b(),m("div",{key:0,class:"text-center py-4 text-gray-500"}," Đang tải danh sách quyền... ")):(b(),m("div",{key:1},[K.value?(b(),m(d(I.value),{key:1,modelValue:J.permissions,"onUpdate:modelValue":e=>J.permissions=e,options:Q.value,multiple:!0,searchable:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Chọn quyền...",label:"label","track-by":"value","preselect-first":!1,class:{"border-red-500":P.permissions||v.apiErrors.permissions},onInput:B},null,40,["modelValue","onUpdate:modelValue","options","class"])):(b(),m("div",{key:0,class:"flex items-center justify-center p-4 border-2 border-dashed border-gray-300 rounded-lg"},[n("div",{class:"text-center"},[n("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto mb-2"}),n("p",{class:"text-gray-600 text-sm"},"Đang tải component...")])]))])),P.permissions?(b(),m("p",{key:2,class:"mt-1 text-sm text-red-600"},x(P.permissions),1)):v.apiErrors.permissions?(b(),m("p",{key:3,class:"mt-1 text-sm text-red-600"},x(v.apiErrors.permissions),1)):p("",!0)]),n("div",{class:"flex justify-end space-x-3 pt-4"},[n("button",{type:"button",onClick:F,class:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none"}," Hủy "),n("button",{type:"submit",class:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none",disabled:W.value},x(W.value?"Đang xử lý...":v.role?"Cập nhật":"Thêm mới"),9,["disabled"])])],32)];r(`<form class="space-y-4"${s}><div${s}><label for="name" class="block text-sm font-medium text-gray-700 mb-1"${s}>Tên vai trò <span class="text-red-500"${s}>*</span></label><input id="name"${$("value",J.name)} type="text" class="${h([{"border-red-500":P.name||v.apiErrors.name},"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"])}"${s}>`),P.name?r(`<p class="mt-1 text-sm text-red-600"${s}>${E(P.name)}</p>`):v.apiErrors.name?r(`<p class="mt-1 text-sm text-red-600"${s}>${E(v.apiErrors.name)}</p>`):r("\x3c!----\x3e"),r(`</div><div${s}><label for="display_name" class="block text-sm font-medium text-gray-700 mb-1"${s}>Tên hiển thị</label><input id="display_name"${$("value",J.display_name)} type="text" class="${h([{"border-red-500":P.display_name||v.apiErrors.display_name},"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"])}"${s}>`),P.display_name?r(`<p class="mt-1 text-sm text-red-600"${s}>${E(P.display_name)}</p>`):v.apiErrors.display_name?r(`<p class="mt-1 text-sm text-red-600"${s}>${E(v.apiErrors.display_name)}</p>`):r("\x3c!----\x3e"),r(`</div><div${s}><label for="guard_name" class="block text-sm font-medium text-gray-700 mb-1"${s}>Guard</label><input id="guard_name"${$("value",J.guard_name)} type="text" class="${h([{"border-red-500":P.guard_name||v.apiErrors.guard_name},"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"])}"${s}>`),P.guard_name?r(`<p class="mt-1 text-sm text-red-600"${s}>${E(P.guard_name)}</p>`):v.apiErrors.guard_name?r(`<p class="mt-1 text-sm text-red-600"${s}>${E(v.apiErrors.guard_name)}</p>`):r("\x3c!----\x3e"),r(`</div><div${s}><label for="parent_id" class="block text-sm font-medium text-gray-700 mb-1"${s}>Vai trò cha</label><select id="parent_id" class="${h([{"border-red-500":P.parent_id||v.apiErrors.parent_id},"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"])}"${s}><option value=""${k(Array.isArray(J.parent_id)?w(J.parent_id,""):V(J.parent_id,""))?" selected":""}${s}>-- Không có --</option>\x3c!--[--\x3e`),U(R.value,e=>{r(`<option${$("value",e.id)}${k(Array.isArray(J.parent_id)?w(J.parent_id,e.id):V(J.parent_id,e.id))?" selected":""}${s}>${E(e.display_name||e.name)}</option>`)}),r("\x3c!--]--\x3e</select>"),P.parent_id?r(`<p class="mt-1 text-sm text-red-600"${s}>${E(P.parent_id)}</p>`):v.apiErrors.parent_id?r(`<p class="mt-1 text-sm text-red-600"${s}>${E(v.apiErrors.parent_id)}</p>`):r("\x3c!----\x3e"),r(`</div><div${s}><label for="status" class="block text-sm font-medium text-gray-700 mb-1"${s}>Trạng thái</label><select id="status" class="${h([{"border-red-500":P.status||v.apiErrors.status},"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"])}"${s}>\x3c!--[--\x3e`),U(H.value,(e,t)=>{r(`<option${$("value",t)}${k(Array.isArray(J.status)?w(J.status,t):V(J.status,t))?" selected":""}${s}>${E(e)}</option>`)}),r("\x3c!--]--\x3e</select>"),P.status?r(`<p class="mt-1 text-sm text-red-600"${s}>${E(P.status)}</p>`):v.apiErrors.status?r(`<p class="mt-1 text-sm text-red-600"${s}>${E(v.apiErrors.status)}</p>`):r("\x3c!----\x3e"),r(`</div><div${s}><label class="block text-sm font-medium text-gray-700 mb-1"${s}>Quyền</label>`),D.value?r(`<div class="text-center py-4 text-gray-500"${s}> Đang tải danh sách quyền... </div>`):(r(`<div${s}>`),K.value?A(r,n(d(I.value),{modelValue:J.permissions,"onUpdate:modelValue":e=>J.permissions=e,options:Q.value,multiple:!0,searchable:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Chọn quyền...",label:"label","track-by":"value","preselect-first":!1,class:{"border-red-500":P.permissions||v.apiErrors.permissions},onInput:B},null),t,s):r(`<div class="flex items-center justify-center p-4 border-2 border-dashed border-gray-300 rounded-lg"${s}><div class="text-center"${s}><div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto mb-2"${s}></div><p class="text-gray-600 text-sm"${s}>Đang tải component...</p></div></div>`),r("</div>")),P.permissions?r(`<p class="mt-1 text-sm text-red-600"${s}>${E(P.permissions)}</p>`):v.apiErrors.permissions?r(`<p class="mt-1 text-sm text-red-600"${s}>${E(v.apiErrors.permissions)}</p>`):r("\x3c!----\x3e"),r(`</div><div class="flex justify-end space-x-3 pt-4"${s}><button type="button" class="px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none"${s}> Hủy </button><button type="submit" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none"${k(W.value)?" disabled":""}${s}>${E(W.value?"Đang xử lý...":v.role?"Cập nhật":"Thêm mới")}</button></div></form>`)}),_:1},t))}}},M=C.setup;C.setup=(e,r)=>{const t=v();return(t.modules||(t.modules=new Set)).add("pages/admin/Roles/form.vue"),M?M(e,r):void 0};export{C as default};
