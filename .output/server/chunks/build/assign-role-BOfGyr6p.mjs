import{ref as e,computed as l,watch as r,mergeProps as o,withCtx as a,unref as s,createVNode as t,createTextVNode as n,toDisplayString as i,useSSRContext as d}from"vue";import{ssrRenderComponent as u,ssrInterpolate as m,ssrRenderAttrs as c,ssrRenderClass as p,ssrRenderList as v,ssrIncludeBooleanAttr as g}from"vue/server-renderer";import{R as x}from"./Modal-CcMmmM3q.mjs";import{j as b}from"./FormWrapper-BkWXOK5b.mjs";import{p as f}from"./endpoints-B4pxijLT.mjs";import{l as _}from"./useApiFormSubmit-CTcJmgU_.mjs";import{s as V}from"./apiClient-CZcLLw7q.mjs";import"./_plugin-vue_export-helper-DlAUqK2U.mjs";import"axios";const w={__name:"CoreSelectMultipleSelect",__ssrInlineRender:!0,props:{modelValue:{type:Array,default:()=>[]},options:{type:Array,default:()=>[]},label:{type:String,default:""},placeholder:{type:String,default:"Chọn..."},error:{type:String,default:""}},emits:["update:modelValue"],setup(r,{emit:o}){const a=r,s=e(!1),t=l(()=>a.modelValue.map(e=>{const l=a.options.find(l=>l.value==e);return{value:e,label:l?l.label:e}}));return(e,l,o,a)=>{l(`<div${c(a)}>`),r.label?l(`<label class="block text-sm font-medium mb-1">${m(r.label)}</label>`):l("\x3c!----\x3e"),l(`<div class="relative"><div class="${p([{"border-red-500":r.error},"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 cursor-pointer bg-white"])}"><div class="flex flex-wrap gap-1">`),0===r.modelValue.length?l(`<span class="text-gray-500">${m(r.placeholder)}</span>`):l("\x3c!----\x3e"),l("\x3c!--[--\x3e"),v(t.value,e=>{l(`<span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-indigo-100 text-indigo-800">${m(e.label)} <button class="ml-1 text-indigo-600 hover:text-indigo-800"> × </button></span>`)}),l("\x3c!--]--\x3e</div></div>"),s.value?(l('<div class="absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto">\x3c!--[--\x3e'),v(r.options,e=>{l(`<div class="px-3 py-2 hover:bg-gray-100 cursor-pointer flex items-center"><input type="checkbox"${g(r.modelValue.includes(e.value))?" checked":""} class="mr-2 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" readonly> ${m(e.label)}</div>`)}),l("\x3c!--]--\x3e</div>")):l("\x3c!----\x3e"),l("</div>"),r.error?l(`<p class="mt-1 text-sm text-red-600">${m(r.error)}</p>`):l("\x3c!----\x3e"),l("</div>")}}},C=w.setup;w.setup=(e,l)=>{const r=d();return(r.modules||(r.modules=new Set)).add("components/Core/Select/MultipleSelect.vue"),C?C(e,l):void 0};const $={__name:"assign-role",__ssrInlineRender:!0,props:{show:Boolean,user:Object,onClose:Function},emits:["role-assigned"],setup(d,{emit:c}){const p=d,v=c,g=e(null),C=e([]);l(()=>`Phân quyền cho ${g.value?.name||g.value?.username||"người dùng"}`);const $=l({get:()=>p.show,set:()=>S()});async function y(){try{const e=await V.get(f.users.showWithRoles(p.user.id));e.data.success&&(g.value=e.data.data)}catch(e){console.error("Error fetching user detail:",e)}}async function h(){try{const e=await V.get(f.roles.list);e.data.success?C.value=e.data.data:console.error("Roles API returned success: false")}catch(e){console.error("Error loading roles:",e)}}r(()=>p.show,async e=>{e&&p.user?.id&&await Promise.all([y(),h()])},{immediate:!0});const A=l(()=>{const e=g.value||{};let l=[];return e.roles&&Array.isArray(e.roles)&&(l=e.roles.map(e=>e.id)),{role_ids:l,...e}}),{apiErrors:U,submit:j}=_({endpoint:f.users.assignRoles(p.user?.id),emit:v,onClose:p.onClose,eventName:"role-assigned",method:"post"}),q=l(()=>({role_ids:[{required:"Vui lòng chọn ít nhất một vai trò."}]})),E=l(()=>(C.value||[]).map(e=>({value:e.id,label:e.name})));async function T(e){const l={role_ids:Array.isArray(e.role_ids)?e.role_ids:[e.role_ids].filter(Boolean)};await j(l)}function S(){v("role-assigned")}return(e,l,r,d)=>{l(u(x,o({modelValue:$.value,"onUpdate:modelValue":e=>$.value=e,title:"Phân quyền người dùng"},d),{default:a((e,l,r,o)=>{if(!l)return[t(b,{"default-values":A.value,rules:q.value,"api-errors":s(U),"submit-text":"Cập nhật quyền",onSubmit:T,onCancel:S},{default:a(({form:e,errors:l,clearError:r,isSubmitting:o})=>[t("div",{class:"mb-4 p-3 bg-gray-50 rounded-lg"},[t("div",{class:"text-sm text-gray-600"},[t("div",null,[t("strong",null,"Tên:"),n(" "+i(g.value?.name||g.value?.username||"N/A"),1)]),t("div",null,[t("strong",null,"Email:"),n(" "+i(g.value?.email||"N/A"),1)])])]),t(w,{modelValue:e.role_ids,"onUpdate:modelValue":[l=>e.role_ids=l,e=>r("role_ids")],label:"Vai trò",options:E.value,error:l.role_ids,placeholder:"Chọn vai trò..."},null,8,["modelValue","onUpdate:modelValue","options","error"])]),_:1},8,["default-values","rules","api-errors"])];l(u(b,{"default-values":A.value,rules:q.value,"api-errors":s(U),"submit-text":"Cập nhật quyền",onSubmit:T,onCancel:S},{default:a(({form:e,errors:l,clearError:r,isSubmitting:o},a,s,d)=>{if(!a)return[t("div",{class:"mb-4 p-3 bg-gray-50 rounded-lg"},[t("div",{class:"text-sm text-gray-600"},[t("div",null,[t("strong",null,"Tên:"),n(" "+i(g.value?.name||g.value?.username||"N/A"),1)]),t("div",null,[t("strong",null,"Email:"),n(" "+i(g.value?.email||"N/A"),1)])])]),t(w,{modelValue:e.role_ids,"onUpdate:modelValue":[l=>e.role_ids=l,e=>r("role_ids")],label:"Vai trò",options:E.value,error:l.role_ids,placeholder:"Chọn vai trò..."},null,8,["modelValue","onUpdate:modelValue","options","error"])];a(`<div class="mb-4 p-3 bg-gray-50 rounded-lg"${d}><div class="text-sm text-gray-600"${d}><div${d}><strong${d}>Tên:</strong> ${m(g.value?.name||g.value?.username||"N/A")}</div><div${d}><strong${d}>Email:</strong> ${m(g.value?.email||"N/A")}</div></div></div>`),a(u(w,{modelValue:e.role_ids,"onUpdate:modelValue":[l=>e.role_ids=l,e=>r("role_ids")],label:"Vai trò",options:E.value,error:l.role_ids,placeholder:"Chọn vai trò..."},null,s,d))}),_:1},r,o))}),_:1},r))}}},A=$.setup;$.setup=(e,l)=>{const r=d();return(r.modules||(r.modules=new Set)).add("pages/admin/users/assign-role.vue"),A?A(e,l):void 0};export{$ as default};
