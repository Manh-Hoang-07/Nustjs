import{e as s}from"./server.mjs";import{ref as e,computed as a}from"vue";import{E as t}from"./useApiClient-LtAAs9ek.mjs";const u=s("auth",()=>{const s=t(),u=e(!1),n=e(null),r=e(""),i=e(!1),l=e(0),o=e(!1),g=a(()=>"admin"===r.value),h=a(()=>"user"===r.value),c=async(s=!1)=>{try{return i.value=!0,u.value=!1,n.value=null,void(r.value="")}catch(s){(401===s.response?.status||403===s.response?.status)&&(u.value=!1,n.value=null,r.value="")}finally{i.value=!1}};return{isAuthenticated:u,user:n,userRole:r,isFetchingUser:i,lastFetchTime:l,isInitialized:o,isAdmin:g,isUser:h,login:async e=>{try{const a=await s.post("/api/login",e);return a.data.success?(u.value=!0,a.data.data.token&&a.data.data.token,await c(),{success:!0,data:a.data.data}):{success:!1,message:a.data.message||"Đăng nhập thất bại"}}catch(s){return 401===s.response?.status?{success:!1,message:"Email hoặc mật khẩu không đúng"}:422===s.response?.status?{success:!1,message:"Dữ liệu không hợp lệ"}:"ECONNABORTED"===s.code?{success:!1,message:"Kết nối bị timeout, vui lòng thử lại"}:s.response?{success:!1,message:s.userMessage||"Lỗi kết nối"}:{success:!1,message:"Không thể kết nối đến server"}}},register:async e=>{try{const a=await s.post("/api/register",e);return a.data.success?{success:!0,data:a.data.data}:{success:!1,message:a.data.message||"Đăng ký thất bại"}}catch(s){return 422===s.response?.status?{success:!1,message:"Dữ liệu không hợp lệ"}:409===s.response?.status?{success:!1,message:"Email đã tồn tại"}:"ECONNABORTED"===s.code?{success:!1,message:"Kết nối bị timeout, vui lòng thử lại"}:s.response?{success:!1,message:s.userMessage||"Lỗi kết nối"}:{success:!1,message:"Không thể kết nối đến server"}}},logout:async()=>{try{await s.post("/api/logout")}catch{}u.value=!1,n.value=null,r.value="",l.value=0},fetchUserInfo:c,checkAuth:async()=>(o.value=!0,u.value=!1,n.value=null,r.value="",!1),refreshUserInfo:async()=>{await c(!0)},updateProfile:async s=>{try{const e=await $fetch("/api/profile",{method:"PUT",body:s});return e.success?(n.value={...n.value,...e.data},{success:!0,data:e.data}):{success:!1,message:e.message||"Cập nhật thất bại"}}catch(s){return{success:!1,message:s.userMessage||"Lỗi cập nhật"}}},changePassword:async s=>{try{const e=await $fetch("/api/change-password",{method:"POST",body:s});return e.success?{success:!0,message:"Đổi mật khẩu thành công"}:{success:!1,message:e.message||"Đổi mật khẩu thất bại"}}catch(s){return{success:!1,message:s.userMessage||"Lỗi đổi mật khẩu"}}}}});export{u as F};
