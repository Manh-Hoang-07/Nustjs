import{M as J,G as B,I as r,N as Y,z as Z,c as o,a as e,e as g,b as S,t as l,k as C,d as ee,F as _,g as E,ad as te,o as n,H as ae}from"./CRPNSmKO.js";import se from"./uGLxF0GB.js";import ne from"./B9eftp_Y.js";import oe from"./Bk8NTgma.js";import{e as L}from"./B4pxijLT.js";import{f as re}from"./CNGtvvPC.js";import{g as le}from"./Bz77BRzt.js";import"./D3qKhv56.js";import"./DlAUqK2U.js";import"./D_8RvcO3.js";import"./Dlbv5MmI.js";import"./CONOwAJH.js";import"./CaxYi4Fr.js";import"./BTrW77Yx.js";const Ce={__name:"edit-page",setup(ie){const u=J(),T=te(),d=B(()=>T.params.id),i=r("basic"),$=r(null),v=r([]),x=r([]),f=r(!1),p=Y({}),I=r({}),m=r(!1),h=r(!1),y=r(null),b=r(null),N=B(()=>v.value.length),U=B(()=>x.value.length);Z(async()=>{H(),await Promise.all([j(),w(),k()])});async function j(){try{const t=await u.get(L.products.update(d.value));$.value=t.data}catch{}}async function w(){try{const t=await u.get(`/api/admin/products/${d.value}/variants`);v.value=t.data.data||[]}catch{}}async function k(){try{const t=await u.get(`/api/admin/products/${d.value}/images`);x.value=t.data.data||[]}catch{}}function H(){const t=le("product_status");I.value=t.map(s=>({value:s.value,label:s.label}))}async function K(t){f.value=!0;try{Object.keys(p).forEach(a=>delete p[a]);const s={...t,_method:"PUT"};await u.post(L.products.update(d.value),s),await j()}catch(s){if(s.response?.status===422&&s.response?.data?.errors){const a=s.response.data.errors;for(const c in a)Array.isArray(a[c])?p[c]=a[c][0]:p[c]=a[c]}}finally{f.value=!1}}async function P(){const t=document.querySelector("form");t&&t.dispatchEvent(new Event("submit",{bubbles:!0}))}function z(){y.value=null,m.value=!0}function A(t){y.value=t,m.value=!0}function M(){m.value=!1,y.value=null}async function O(){await w(),M()}async function Q(){await w(),M()}async function q(t){if(confirm(`Bạn có chắc chắn muốn xóa biến thể ${t.sku}?`))try{await u.delete(`/api/admin/variants/${t.id}`),await w()}catch{}}function D(){b.value=null,h.value=!0}function F(t){b.value=t,h.value=!0}function V(){h.value=!1,b.value=null}async function G(){await k(),V()}async function X(){await k(),V()}async function R(t){if(confirm("Bạn có chắc chắn muốn xóa ảnh này?"))try{await u.delete(`/api/admin/images/${t.id}`),await k()}catch{}}function W(t){return t==="active"?"Đang bán":t==="inactive"?"Ngừng bán":t}return(t,s)=>(n(),o("div",{class:"container mx-auto p-4"},[e("div",{class:"flex justify-between items-center mb-6"},[e("div",null,[e("h1",{class:"text-2xl font-bold"},"Chỉnh sửa sản phẩm"),e("p",{class:"text-gray-600 mt-1"},l($.value?.name),1)]),e("div",{class:"flex space-x-3"},[e("button",{onClick:s[0]||(s[0]=a=>t.$router.push("/admin/products")),class:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 focus:outline-none"}," Quay lại danh sách "),e("button",{onClick:P,class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none",disabled:f.value},l(f.value?"Đang lưu...":"Lưu thay đổi"),9,["disabled"])])]),e("div",{class:"mb-6"},[e("nav",{class:"flex space-x-8"},[e("button",{onClick:s[1]||(s[1]=a=>i.value="basic"),class:C(["py-2 px-1 border-b-2 font-medium text-sm",i.value==="basic"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Thông tin cơ bản ",2),e("button",{onClick:s[2]||(s[2]=a=>i.value="variants"),class:C(["py-2 px-1 border-b-2 font-medium text-sm",i.value==="variants"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Biến thể ("+l(N.value)+") ",3),e("button",{onClick:s[3]||(s[3]=a=>i.value="images"),class:C(["py-2 px-1 border-b-2 font-medium text-sm",i.value==="images"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Ảnh sản phẩm ("+l(U.value)+") ",3)])]),i.value==="basic"?(n(),o("div",{key:0,class:"bg-white rounded-lg shadow p-6"},[ee(se,{show:!0,product:$.value,"api-errors":p,"status-options":I.value,onSubmit:K,onCancel:()=>{}},null,8,["product","api-errors","status-options"])])):i.value==="variants"?(n(),o("div",{key:1,class:"bg-white rounded-lg shadow"},[e("div",{class:"p-6 border-b"},[e("div",{class:"flex justify-between items-center"},[e("h2",{class:"text-lg font-medium"},"Quản lý biến thể sản phẩm"),e("button",{onClick:z,class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none"}," Thêm biến thể mới ")])]),e("div",{class:"overflow-x-auto"},[e("table",{class:"min-w-full divide-y divide-gray-200"},[e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"SKU"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Ảnh"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Giá"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Số lượng"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Trạng thái"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Thao tác")])]),e("tbody",{class:"bg-white divide-y divide-gray-200"},[(n(!0),o(_,null,E(v.value,a=>(n(),o("tr",{key:a.id},[e("td",{class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},l(a.sku),1),e("td",{class:"px-6 py-4 whitespace-nowrap"},[a.image?(n(),o("img",{key:0,src:a.image,alt:a.sku,class:"h-10 w-10 rounded-lg object-cover"},null,8,["src","alt"])):(n(),o("div",{key:1,class:"h-10 w-10 rounded-lg bg-gray-200 flex items-center justify-center"},[e("span",{class:"text-gray-400 text-xs"},"No img")]))]),e("td",{class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},l(ae(re)(a.price)),1),e("td",{class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},l(a.quantity),1),e("td",{class:"px-6 py-4 whitespace-nowrap"},[e("span",{class:C(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",a.status==="active"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},l(W(a.status)),3)]),e("td",{class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},[e("button",{onClick:c=>A(a),class:"text-indigo-600 hover:text-indigo-900 mr-3"},"Sửa",8,["onClick"]),e("button",{onClick:c=>q(a),class:"text-red-600 hover:text-red-900"},"Xóa",8,["onClick"])])]))),128)),v.value.length===0?(n(),o("tr",{key:0},[e("td",{colspan:"6",class:"px-6 py-4 text-center text-gray-500"}," Không có biến thể nào ")])):g("",!0)])])])])):i.value==="images"?(n(),o("div",{key:2,class:"bg-white rounded-lg shadow"},[e("div",{class:"p-6 border-b"},[e("div",{class:"flex justify-between items-center"},[e("h2",{class:"text-lg font-medium"},"Quản lý ảnh sản phẩm"),e("button",{onClick:D,class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none"}," Thêm ảnh mới ")])]),e("div",{class:"p-6"},[e("div",{class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"},[(n(!0),o(_,null,E(x.value,a=>(n(),o("div",{key:a.id,class:"bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-200"},[e("div",{class:"relative"},[e("img",{src:a.url,alt:a.alt_text||"Product image",class:"w-full h-48 object-cover"},null,8,["src","alt"]),e("div",{class:"absolute top-2 right-2 flex space-x-1"},[e("button",{onClick:c=>F(a),class:"p-1 bg-blue-500 text-white rounded-full hover:bg-blue-600 focus:outline-none",title:"Chỉnh sửa"},[(n(),o("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})]))],8,["onClick"]),e("button",{onClick:c=>R(a),class:"p-1 bg-red-500 text-white rounded-full hover:bg-red-600 focus:outline-none",title:"Xóa"},[(n(),o("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})]))],8,["onClick"])])]),e("div",{class:"p-4"},[e("h3",{class:"font-medium text-gray-900 mb-1"},l(a.alt_text||"Không có mô tả"),1),e("p",{class:"text-sm text-gray-500"},l(a.caption||"Không có chú thích"),1)])]))),128))]),x.value.length===0?(n(),o("div",{key:0,class:"text-center py-12"},[(n(),o("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})])),e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Không có ảnh nào"),e("p",{class:"mt-1 text-sm text-gray-500"},"Bắt đầu bằng cách thêm ảnh mới cho sản phẩm.")])):g("",!0)])])):g("",!0),m.value?(n(),S(ne,{key:3,show:m.value,variant:y.value,"product-id":d.value,"on-close":M,onCreated:O,onUpdated:Q},null,8,["show","variant","product-id"])):g("",!0),h.value?(n(),S(oe,{key:4,show:h.value,image:b.value,"product-id":d.value,"on-close":V,onCreated:G,onUpdated:X},null,8,["show","image","product-id"])):g("",!0)]))}};export{Ce as default};
