import{M as B}from"./D3qKhv56.js";import{_ as O}from"./D_8RvcO3.js";import{_ as s}from"./Dlbv5MmI.js";import{a as T}from"./CaxYi4Fr.js";import{G as r,I as h,O as N,b as j,i as V,o as G,d as l,a as o}from"./CRPNSmKO.js";import"./DlAUqK2U.js";const z={__name:"form",props:{show:Boolean,inventory:{type:Object,default:null},apiErrors:{type:Object,default:()=>({})},products:{type:Array,default:()=>[]},warehouses:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["submit","cancel"],setup(m,{emit:b}){const i=m,v=b,_=r({get:()=>i.show,set:()=>y()}),f=h(null),p=h([]),c=h(""),q=r(()=>i.inventory?"Chỉnh sửa tồn kho":"Thêm tồn kho mới"),x=r(()=>({product_id:"",variant_id:"",warehouse_id:"",quantity:0,batch_no:"",lot_no:"",expiry_date:"",cost_price:null,reserved_quantity:0,...i.inventory||{}})),U=r(()=>({product_id:[{required:"Vui lòng chọn sản phẩm."}],warehouse_id:[{required:"Vui lòng chọn kho hàng."}],quantity:[{required:"Vui lòng nhập số lượng."},{integer:"Số lượng phải là số nguyên."},{min:[0,"Số lượng không được âm."]}],reserved_quantity:[{integer:"Số lượng đã giữ chỗ phải là số nguyên."},{min:[0,"Số lượng đã giữ chỗ không được âm."]}],batch_no:[{max:[100,"Mã lô hàng không được vượt quá 100 ký tự."]}],lot_no:[{max:[100,"Số lô sản xuất không được vượt quá 100 ký tự."]}],expiry_date:[{date:"Hạn sử dụng không đúng định dạng."},{after:["today","Hạn sử dụng phải sau ngày hiện tại."]}],cost_price:[{numeric:"Giá vốn phải là số."},{min:[0,"Giá vốn không được âm."]}]})),k=r(()=>[{value:"",label:"Chọn sản phẩm"},...i.products.map(a=>({value:a.id,label:`${a.name} (${a.code})`}))]),$=r(()=>[{value:"",label:"Chọn kho hàng"},...i.warehouses.map(a=>({value:a.id,label:a.name}))]),w=r(()=>{if(!c.value)return[{value:"",label:"Chọn sản phẩm trước"}];const a=p.value.filter(n=>n.product_id==c.value);return[{value:"",label:"Không chọn biến thể"},...a.map(n=>({value:String(n.id),label:`${n.sku} - ${n.name||"Không có tên"}`}))]});N(()=>i.inventory,a=>{a?.product_id&&(c.value=a.product_id,g(a.product_id))},{immediate:!0});async function S(a){c.value=a,i.inventory||(p.value=[]),a?await g(a):p.value=[]}async function g(a){try{const n=await T.get(`/api/admin/products/${a}/variants`);n.data.success?p.value=n.data.data||[]:p.value=n.data||[]}catch{p.value=[]}}function C(a){v("submit",a)}function y(){v("cancel")}return(a,n)=>(G(),j(B,{modelValue:_.value,"onUpdate:modelValue":n[0]||(n[0]=t=>_.value=t),title:q.value,loading:m.loading,size:"4xl"},{default:V(()=>[l(O,{"default-values":x.value,rules:U.value,"api-errors":m.apiErrors,"submit-text":i.inventory?"Cập nhật":"Tạo tồn kho",onSubmit:C,onCancel:y,ref_key:"formWrapperRef",ref:f},{default:V(({form:t,errors:d,clearError:u,isSubmitting:M})=>[o("div",{class:"space-y-6"},[o("div",{class:"bg-gray-50 p-6 rounded-lg"},[o("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Thông tin tồn kho"),o("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-6"},[o("div",{class:"md:col-span-2"},[l(s,{modelValue:t.product_id,"onUpdate:modelValue":[e=>t.product_id=e,e=>{u("product_id"),S(e),i.inventory||(t.variant_id="")}],label:"Sản phẩm",name:"product_id",type:"select",options:k.value,error:d.product_id,required:""},null,8,["modelValue","onUpdate:modelValue","options","error"])]),o("div",{class:"md:col-span-2"},[l(s,{modelValue:t.variant_id,"onUpdate:modelValue":[e=>t.variant_id=e,e=>u("variant_id")],label:"Biến thể sản phẩm (Tùy chọn)",name:"variant_id",type:"select",options:w.value,error:d.variant_id},null,8,["modelValue","onUpdate:modelValue","options","error"])]),o("div",{class:"md:col-span-2"},[l(s,{modelValue:t.warehouse_id,"onUpdate:modelValue":[e=>t.warehouse_id=e,e=>u("warehouse_id")],label:"Kho hàng",name:"warehouse_id",type:"select",options:$.value,error:d.warehouse_id,required:""},null,8,["modelValue","onUpdate:modelValue","options","error"])]),l(s,{modelValue:t.quantity,"onUpdate:modelValue":[e=>t.quantity=e,e=>u("quantity")],label:"Số lượng",name:"quantity",type:"number",error:d.quantity,required:"",min:0},null,8,["modelValue","onUpdate:modelValue","error"]),l(s,{modelValue:t.reserved_quantity,"onUpdate:modelValue":[e=>t.reserved_quantity=e,e=>u("reserved_quantity")],label:"Số lượng đã giữ chỗ",name:"reserved_quantity",type:"number",error:d.reserved_quantity,min:0},null,8,["modelValue","onUpdate:modelValue","error"])])]),o("div",{class:"bg-gray-50 p-6 rounded-lg"},[o("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Thông tin lô hàng"),o("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-6"},[l(s,{modelValue:t.batch_no,"onUpdate:modelValue":[e=>t.batch_no=e,e=>u("batch_no")],label:"Mã lô hàng",name:"batch_no",error:d.batch_no,placeholder:"Nhập mã lô hàng"},null,8,["modelValue","onUpdate:modelValue","error"]),l(s,{modelValue:t.lot_no,"onUpdate:modelValue":[e=>t.lot_no=e,e=>u("lot_no")],label:"Số lô sản xuất",name:"lot_no",error:d.lot_no,placeholder:"Nhập số lô sản xuất"},null,8,["modelValue","onUpdate:modelValue","error"]),l(s,{modelValue:t.expiry_date,"onUpdate:modelValue":[e=>t.expiry_date=e,e=>u("expiry_date")],label:"Hạn sử dụng",name:"expiry_date",type:"date",error:d.expiry_date},null,8,["modelValue","onUpdate:modelValue","error"]),l(s,{modelValue:t.cost_price,"onUpdate:modelValue":[e=>t.cost_price=e,e=>u("cost_price")],label:"Giá vốn",name:"cost_price",type:"number",error:d.cost_price,min:0,step:.01,placeholder:"Nhập giá vốn"},null,8,["modelValue","onUpdate:modelValue","error"])])])])]),_:1},8,["default-values","rules","api-errors","submit-text"])]),_:1},8,["modelValue","title","loading"]))}};export{z as default};
