import{N as v,I as O,G as T,O as x,c as p,o as g,r as j,a as y,e as w,t as h,w as V,j as A}from"./CRPNSmKO.js";function E(a,f){const o={};for(const t in f){const d=a&&a[t]!==void 0&&a[t]!==null?a[t]:"";let e;t==="password"?e=d.toString():e=d.toString().trim();for(const s of f[t])if(typeof s=="string"){if(s==="required"&&!e){o[t]="Trường này là bắt buộc.";break}if(s==="email"&&e&&!/^\S+@\S+\.\S+$/.test(e)){o[t]="Email không hợp lệ.";break}}else if(typeof s=="object")for(const i in s){const n=s[i];if(i==="required"&&!e){o[t]=n;break}if(i==="email"&&e&&!/^\S+@\S+\.\S+$/.test(e)){o[t]=n;break}if(i==="min"&&e){const[u,c]=Array.isArray(n)?n:[n,`Tối thiểu ${n} ký tự.`];if(e.length<u){o[t]=c;break}}if(i==="match"&&e){const[u,c]=Array.isArray(n)?n:[n,"Giá trị xác nhận không khớp."],b=a&&a[u]!==void 0&&a[u]!==null?a[u]:"",m=u==="password"?b.toString():b.toString().trim();if(e!==m){o[t]=c;break}}if(i==="pattern"&&e){const[u,c]=Array.isArray(n)?n:[n,"Định dạng không hợp lệ."];if(!u.test(e)){o[t]=c;break}}}}return o}const C={__name:"CoreFormWrapper",props:{initialData:{type:Object,default:()=>({})},defaultValues:{type:Object,default:()=>({})},rules:{type:Object,default:()=>({})},apiErrors:{type:Object,default:()=>({})},showCancelButton:{type:Boolean,default:!0},submitText:{type:String,default:"Lưu"},submittingText:{type:String,default:"Đang lưu..."},cancelText:{type:String,default:"Hủy"},disableSubmit:{type:Boolean,default:!1}},emits:["submit","cancel","error"],setup(a,{expose:f,emit:o}){const t=a,d=o,e=v({...t.defaultValues,...t.initialData}),s=v({}),i=O(!1),n=r=>{Object.keys(r).forEach(l=>{l in e&&(e[l]=r[l])})},u=T(()=>({...s,...t.apiErrors}));x(()=>t.defaultValues,r=>{Object.keys(r).forEach(l=>{l in e&&(e[l]=r[l])})},{deep:!0}),x(()=>t.initialData,r=>{r&&Object.keys(r).length>0&&Object.keys(e).forEach(l=>{l in r&&(e[l]=r[l])})},{deep:!0});function c(r){delete s[r]}function b(){Object.keys(s).forEach(r=>delete s[r])}function m(){if(b(),!t.rules||Object.keys(t.rules).length===0)return!0;const r=E(e,t.rules);return Object.keys(r).length>0?(Object.assign(s,r),d("error",r),!1):!0}async function k(){if(!i.value&&m()){i.value=!0;try{d("submit",{...e})}finally{i.value=!1}}}function S(){d("cancel")}return f({updateForm:n,form:e,validate:()=>E(e,t.rules)}),(r,l)=>(g(),p("div",{class:"form-wrapper"},[j(r.$slots,"default",{form:e,errors:u.value,isSubmitting:i.value,clearError:c,validate:m}),y("div",{class:"mt-4 flex justify-end space-x-2"},[j(r.$slots,"actions",{submit:k,cancel:S},()=>[a.showCancelButton?(g(),p("button",{key:0,type:"button",class:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none",onClick:S},h(a.cancelText),1)):w("",!0),y("button",{type:"submit",class:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none",disabled:i.value||a.disableSubmit,onClick:V(k,["prevent"])},[i.value?(g(),p("span",{key:0},[y("span",{class:"inline-block animate-spin mr-2"},"↻"),A(" "+h(a.submittingText),1)])):(g(),p("span",{key:1},h(a.submitText),1))],8,["disabled"])])])]))}};export{C as _};
