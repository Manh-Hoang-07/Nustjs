import{M as K,G as N,N as U,I as v,z as A,O as z,b as I,i as L,o as n,a as t,w as H,f as m,c as u,e as c,j as x,k as b,K as p,t as l,F as h,g as E,P as O}from"./DDT-0HTi.js";import{g as P}from"./Bz77BRzt.js";import{M as R}from"./D_ZLElLM.js";import{e as $}from"./B4pxijLT.js";import"./DlAUqK2U.js";const Z={__name:"variant-form",props:{show:Boolean,variant:Object,productId:[String,Number],apiErrors:{type:Object,default:()=>({})},mode:String},emits:["submit","cancel","created","updated"],setup(i,{emit:j}){const C=K(),f=i,w=j,q=N({get:()=>f.show,set:()=>S()}),M=N(()=>f.mode==="edit"?"Chỉnh sửa biến thể":"Thêm biến thể mới"),e=U({sku:"",barcode:"",price:"",sale_price:"",quantity:"",image:"",status:"",attribute_values:{}}),s=U({}),g=v(!1),y=v({}),k=v([]);A(()=>{T(),B()});function T(){const o=P("variant_status");y.value=o.map(a=>({value:a.value,label:a.label}))}async function B(){try{const o=await C.get($.attributes.list);k.value=o.data.data||[]}catch{k.value=[]}}z(()=>f.variant,o=>{o?(e.sku=o.sku||"",e.barcode=o.barcode||"",e.price=o.price||"",e.sale_price=o.sale_price||"",e.quantity=o.quantity||"",e.image=o.image||"",e.status=o.status||Object.keys(y.value)[0]||"",o.attribute_values&&o.attribute_values.forEach(a=>{e.attribute_values[a.attribute_id]=a.id})):D()},{immediate:!0});function D(){e.sku="",e.barcode="",e.price="",e.sale_price="",e.quantity="",e.image="",e.status=Object.keys(y.value)[0]||"",e.attribute_values={},V()}function V(){Object.keys(s).forEach(o=>delete s[o])}function G(){return V(),e.sku.trim()?e.sku.length>100&&(s.sku="SKU không được vượt quá 100 ký tự"):s.sku="SKU là bắt buộc",!e.price||isNaN(e.price)?s.price="Giá là bắt buộc và phải là số":Number(e.price)<0&&(s.price="Giá không được âm"),e.sale_price&&(isNaN(e.sale_price)||Number(e.sale_price)<0)&&(s.sale_price="Giá khuyến mãi phải là số và không được âm"),!e.quantity||isNaN(e.quantity)?s.quantity="Số lượng là bắt buộc và phải là số":Number(e.quantity)<0&&(s.quantity="Số lượng không được âm"),e.image&&e.image.length>255&&(s.image="Đường dẫn ảnh không được vượt quá 255 ký tự"),Object.keys(s).length===0}function F(){if(G()){g.value=!0;try{const o=new FormData;Object.entries(e).forEach(([a,r])=>{a!=="attribute_values"&&r!==null&&r!==void 0&&r!==""&&o.append(a,r)}),o.append("product_id",f.productId),Object.entries(e.attribute_values).forEach(([a,r])=>{r&&o.append(`attribute_values[${a}]`,r)}),w("submit",o)}finally{g.value=!1}}}function S(){w("cancel")}return(o,a)=>(n(),I(R,{modelValue:q.value,"onUpdate:modelValue":a[7]||(a[7]=r=>q.value=r),title:M.value},{default:L(()=>[t("form",{onSubmit:H(F,["prevent"]),class:"space-y-4"},[t("div",null,[t("label",{class:"block text-sm font-medium mb-1"},[x("SKU "),t("span",{class:"text-red-500"},"*")]),m(t("input",{"onUpdate:modelValue":a[0]||(a[0]=r=>e.sku=r),type:"text",class:b(["w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",{"border-red-500":s.sku||i.apiErrors.sku}]),maxlength:"100"},null,2),[[p,e.sku]]),s.sku?(n(),u("p",{key:0,class:"mt-1 text-sm text-red-600"},l(s.sku),1)):i.apiErrors.sku?(n(),u("p",{key:1,class:"mt-1 text-sm text-red-600"},l(i.apiErrors.sku),1)):c("",!0)]),t("div",null,[t("label",{class:"block text-sm font-medium mb-1"},"Barcode"),m(t("input",{"onUpdate:modelValue":a[1]||(a[1]=r=>e.barcode=r),type:"text",class:b(["w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",{"border-red-500":s.barcode||i.apiErrors.barcode}]),maxlength:"100"},null,2),[[p,e.barcode]]),s.barcode?(n(),u("p",{key:0,class:"mt-1 text-sm text-red-600"},l(s.barcode),1)):i.apiErrors.barcode?(n(),u("p",{key:1,class:"mt-1 text-sm text-red-600"},l(i.apiErrors.barcode),1)):c("",!0)]),t("div",{class:"grid grid-cols-2 gap-4"},[t("div",null,[t("label",{class:"block text-sm font-medium mb-1"},[x("Giá gốc "),t("span",{class:"text-red-500"},"*")]),m(t("input",{"onUpdate:modelValue":a[2]||(a[2]=r=>e.price=r),type:"number",step:"0.01",class:b(["w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",{"border-red-500":s.price||i.apiErrors.price}])},null,2),[[p,e.price]]),s.price?(n(),u("p",{key:0,class:"mt-1 text-sm text-red-600"},l(s.price),1)):i.apiErrors.price?(n(),u("p",{key:1,class:"mt-1 text-sm text-red-600"},l(i.apiErrors.price),1)):c("",!0)]),t("div",null,[t("label",{class:"block text-sm font-medium mb-1"},"Giá khuyến mãi"),m(t("input",{"onUpdate:modelValue":a[3]||(a[3]=r=>e.sale_price=r),type:"number",step:"0.01",class:b(["w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",{"border-red-500":s.sale_price||i.apiErrors.sale_price}])},null,2),[[p,e.sale_price]]),s.sale_price?(n(),u("p",{key:0,class:"mt-1 text-sm text-red-600"},l(s.sale_price),1)):i.apiErrors.sale_price?(n(),u("p",{key:1,class:"mt-1 text-sm text-red-600"},l(i.apiErrors.sale_price),1)):c("",!0)])]),t("div",null,[t("label",{class:"block text-sm font-medium mb-1"},[x("Số lượng "),t("span",{class:"text-red-500"},"*")]),m(t("input",{"onUpdate:modelValue":a[4]||(a[4]=r=>e.quantity=r),type:"number",class:b(["w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",{"border-red-500":s.quantity||i.apiErrors.quantity}])},null,2),[[p,e.quantity]]),s.quantity?(n(),u("p",{key:0,class:"mt-1 text-sm text-red-600"},l(s.quantity),1)):i.apiErrors.quantity?(n(),u("p",{key:1,class:"mt-1 text-sm text-red-600"},l(i.apiErrors.quantity),1)):c("",!0)]),t("div",null,[t("label",{class:"block text-sm font-medium mb-1"},"Ảnh biến thể (URL)"),m(t("input",{"onUpdate:modelValue":a[5]||(a[5]=r=>e.image=r),type:"text",class:b(["w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",{"border-red-500":s.image||i.apiErrors.image}]),maxlength:"255"},null,2),[[p,e.image]]),s.image?(n(),u("p",{key:0,class:"mt-1 text-sm text-red-600"},l(s.image),1)):i.apiErrors.image?(n(),u("p",{key:1,class:"mt-1 text-sm text-red-600"},l(i.apiErrors.image),1)):c("",!0)]),t("div",null,[t("label",{class:"block text-sm font-medium mb-1"},"Thuộc tính"),t("div",{class:"space-y-2"},[(n(!0),u(h,null,E(k.value,r=>(n(),u("div",{key:r.id,class:"flex items-center space-x-3"},[t("span",{class:"text-sm font-medium text-gray-700 w-24"},l(r.name)+":",1),m(t("select",{"onUpdate:modelValue":d=>e.attribute_values[r.id]=d,class:"flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"},[t("option",{value:""},"Chọn giá trị"),(n(!0),u(h,null,E(r.values,d=>(n(),u("option",{key:d.id,value:d.id},l(d.value),9,["value"]))),128))],8,["onUpdate:modelValue"]),[[O,e.attribute_values[r.id]]])]))),128))])]),t("div",null,[t("label",{class:"block text-sm font-medium mb-1"},[x("Trạng thái "),t("span",{class:"text-red-500"},"*")]),m(t("select",{"onUpdate:modelValue":a[6]||(a[6]=r=>e.status=r),class:b(["w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",{"border-red-500":s.status||i.apiErrors.status}])},[(n(!0),u(h,null,E(y.value,(r,d)=>(n(),u("option",{key:d,value:d},l(r),9,["value"]))),128))],2),[[O,e.status]]),s.status?(n(),u("p",{key:0,class:"mt-1 text-sm text-red-600"},l(s.status),1)):i.apiErrors.status?(n(),u("p",{key:1,class:"mt-1 text-sm text-red-600"},l(i.apiErrors.status),1)):c("",!0)]),t("div",{class:"flex justify-end space-x-3 pt-4"},[t("button",{type:"button",onClick:S,class:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none"},"Huỷ"),t("button",{type:"submit",class:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none",disabled:g.value},l(g.value?"Đang xử lý...":i.mode==="edit"?"Cập nhật":"Thêm mới"),9,["disabled"])])],32)]),_:1},8,["modelValue","title"]))}};export{Z as default};
