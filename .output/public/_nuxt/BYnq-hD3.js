import{G as v,c as m,o as u,a as t,e as w,t as p,r as E,F as A,g as M,k as P,d as z,M as W,N as X,z as G,I as U,b as q,i as V,H as n,f as $,h as J,K as Y,P as F}from"./CRPNSmKO.js";import{_ as Z}from"./D2JkzBjR.js";import{_}from"./BN8nsbAe.js";import{e as N}from"./B4pxijLT.js";import"./D3qKhv56.js";import"./DlAUqK2U.js";const ee={__name:"AdminTable",props:{items:{type:Array,default:()=>[]},title:{type:String,default:"Danh sách dữ liệu"},showAddButton:{type:Boolean,default:!0},addButtonText:{type:String,default:"Thêm mới"},emptyText:{type:String,default:"Không có dữ liệu"},showCheckbox:{type:Boolean,default:!1},showPagination:{type:Boolean,default:!0},pagination:{type:Object,default:null},selectedItems:{type:Array,default:()=>[]},itemKey:{type:String,default:"id"}},emits:["add","edit","delete","toggle-all","toggle-item","page-change"],setup(d,{emit:x}){const c=d,f=v(()=>{let l=1;return c.showCheckbox&&(l+=1),c.title&&c.title.includes("Tồn kho")?l=7:l=5,l}),T=v(()=>c.items.length>0&&c.selectedItems.length===c.items.length);function k(l){return c.selectedItems.some(h=>h[c.itemKey]===l[c.itemKey])}function C(l,h){return l[c.itemKey]||h}return(l,h)=>(u(),m("div",{class:"admin-table"},[t("div",{class:"flex justify-between items-center mb-6"},[t("h1",{class:"text-2xl font-bold"},p(d.title),1),d.showAddButton?(u(),m("button",{key:0,onClick:h[0]||(h[0]=e=>l.$emit("add")),class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none"},p(d.addButtonText),1)):w("",!0)]),l.$slots.filters?(u(),m("div",{key:0,class:"mb-6 bg-white p-4 rounded-lg shadow"},[E(l.$slots,"filters")])):w("",!0),t("div",{class:"bg-white shadow-md rounded-lg overflow-hidden"},[t("table",{class:"min-w-full divide-y divide-gray-200"},[t("thead",{class:"bg-gray-50"},[t("tr",null,[d.showCheckbox?(u(),m("th",{key:0,class:"w-12 px-6 py-3"},[t("input",{type:"checkbox",checked:T.value,onChange:h[1]||(h[1]=e=>l.$emit("toggle-all")),class:"rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"},null,40,["checked"])])):w("",!0),E(l.$slots,"header"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," Thao tác ")])]),t("tbody",{class:"bg-white divide-y divide-gray-200"},[d.items.length?(u(!0),m(A,{key:0},M(d.items,(e,y)=>(u(),m("tr",{key:C(e,y),class:P({"bg-gray-50":y%2===0})},[d.showCheckbox?(u(),m("td",{key:0,class:"px-6 py-4 whitespace-nowrap"},[t("input",{type:"checkbox",checked:k(e),onChange:b=>l.$emit("toggle-item",e),class:"rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"},null,40,["checked","onChange"])])):w("",!0),E(l.$slots,"row",{item:e,index:y}),t("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},[E(l.$slots,"actions",{item:e,index:y},()=>[z(Z,{item:e,onEdit:b=>l.$emit("edit",e),onDelete:b=>l.$emit("delete",e)},null,8,["item","onEdit","onDelete"])])])],2))),128)):(u(),m("tr",{key:1},[t("td",{colspan:f.value,class:"px-6 py-4 text-center text-gray-500"},p(d.emptyText),9,["colspan"])]))])])]),d.showPagination?(u(),m("div",{key:1,class:"mt-4 flex justify-between items-center"},[t("div",{class:"text-sm text-gray-700"},[d.pagination?(u(),m("span",{key:0}," Hiển thị "+p(d.pagination.from||0)+" đến "+p(d.pagination.to||0)+" trên tổng số "+p(d.pagination.total||0)+" bản ghi ",1)):w("",!0)]),t("div",{class:"flex space-x-1"},[E(l.$slots,"pagination",{},()=>[d.pagination&&d.pagination.links?(u(!0),m(A,{key:0},M(d.pagination.links,e=>(u(),m("button",{key:e.label,onClick:y=>l.$emit("page-change",e.url),disabled:!e.url,class:P(["px-3 py-1 border rounded",e.active?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50",!e.url&&"opacity-50 cursor-not-allowed"]),innerHTML:e.label},null,10,["onClick","disabled","innerHTML"]))),128)):w("",!0)])])])):w("",!0)]))}};function te(d){const x=W(),{endpoints:c,resourceName:f="dữ liệu",transformItem:T=a=>a,beforeSubmit:k=a=>a,afterFetch:C=a=>a,defaultFilters:l={},debounceTime:h=300}=d,e=X({items:[],selectedItems:[],selectedItem:null,loading:!1,apiErrors:{},pagination:{current_page:1,from:0,to:0,total:0,per_page:10,links:[]},filters:{search:"",page:1,...l},modals:{create:!1,edit:!1,delete:!1,view:!1}}),y={hasItems:v(()=>e.items.length>0),isEmpty:v(()=>!e.loading&&e.items.length===0),hasSelection:v(()=>e.selectedItems.length>0),isAllSelected:v(()=>e.items.length>0&&e.selectedItems.length===e.items.length),selectedCount:v(()=>e.selectedItems.length)};let b=null;const S=a=>{b&&clearTimeout(b),b=setTimeout(a,h)},I={async fetchItems(a=1){e.loading=!0;try{const o={...e.filters,page:a},r=await x.get(c.list,{params:o});return r.data.data&&(e.items=r.data.data.map(T)),r.data.meta&&Object.assign(e.pagination,r.data.meta),C(r.data),r.data}catch(o){return console.error(`Error fetching ${f}:`,o),null}finally{e.loading=!1}},async createItem(a){e.loading=!0,this.clearApiErrors();try{const o=k(a),r=await x.post(c.create,o);return await this.fetchItems(e.pagination.current_page),this.closeCreateModal(),r.data}catch(o){return console.error(`Error creating ${f}:`,o),this.handleApiError(o),null}finally{e.loading=!1}},async updateItem(a){if(!e.selectedItem)return null;e.loading=!0,this.clearApiErrors();try{const o=k(a),r=await x.post(c.update(e.selectedItem.id),o);return await this.fetchItems(e.pagination.current_page),this.closeEditModal(),r.data}catch(o){return console.error(`Error updating ${f}:`,o),this.handleApiError(o),null}finally{e.loading=!1}},async deleteItem(){if(!e.selectedItem)return!1;e.loading=!0;try{return await x.delete(c.delete(e.selectedItem.id)),await this.fetchItems(e.pagination.current_page),this.closeDeleteModal(),!0}catch(a){return console.error(`Error deleting ${f}:`,a),!1}finally{e.loading=!1}},async deleteSelectedItems(){if(!e.selectedItems.length)return!1;e.loading=!0;try{return await Promise.all(e.selectedItems.map(a=>x.delete(c.delete(a.id)))),await this.fetchItems(e.pagination.current_page),e.selectedItems=[],!0}catch(a){return console.error(`Error deleting ${f}:`,a),!1}finally{e.loading=!1}}},D={toggleSelectAll(){e.selectedItems.length===e.items.length?e.selectedItems=[]:e.selectedItems=[...e.items]},toggleSelectItem(a){const o=e.selectedItems.findIndex(r=>r.id===a.id);o===-1?e.selectedItems.push(a):e.selectedItems.splice(o,1)}},K={openCreateModal(){e.modals.create=!0},closeCreateModal(){e.modals.create=!1,this.clearApiErrors()},openEditModal(a){e.selectedItem=a,e.modals.edit=!0},closeEditModal(){e.modals.edit=!1,e.selectedItem=null,this.clearApiErrors()},openDeleteModal(a){e.selectedItem=a,e.modals.delete=!0},closeDeleteModal(){e.modals.delete=!1,e.selectedItem=null},openViewModal(a){e.selectedItem=a,e.modals.view=!0},closeViewModal(){e.modals.view=!1,e.selectedItem=null}},B={handleApiError(a){if(a.response?.status===422&&a.response?.data?.errors){const o=a.response.data.errors;for(const r in o)Array.isArray(o[r])?e.apiErrors[r]=o[r][0]:e.apiErrors[r]=o[r]}},clearApiErrors(){Object.keys(e.apiErrors).forEach(a=>delete e.apiErrors[a])}},H={changePage(a){if(!a)return;const r=new URL(a).searchParams.get("page");I.fetchItems(r)},applyFilters(){S(()=>{I.fetchItems(1)})},resetFilters(){Object.assign(e.filters,{search:"",page:1,...l}),I.fetchItems(1)}};return G(()=>{I.fetchItems()}),{...e,...y,...I,...D,...K,...H,...B}}const ie={__name:"index-new",setup(d){const x=useApiClient(),c=U([]),f=U([]),{items:T,selectedItems:k,selectedItem:C,loading:l,pagination:h,filters:e,showDeleteModal:y,fetchItems:b,deleteItem:S,toggleSelectAll:I,toggleSelectItem:D,openCreateModal:K,openEditModal:B,openDeleteModal:H,closeDeleteModal:a,changePage:o,applyFilters:r,resetFilters:j}=te({endpoints:N.products,resourceName:"sản phẩm",transformItem:i=>({...i,thumbnail:i.thumbnail?i.thumbnail.startsWith("http")?i.thumbnail:`/storage/${i.thumbnail}`:null,category_name:i.category?i.category.name:"Không có",brand_name:i.brand?i.brand.name:"Không có"}),afterFetch:i=>{c.value.length===0&&O(),f.value.length===0&&L()}});async function O(){try{const i=await x.get(N.categories.list,{params:{all:!0}});c.value=i.data.data||[]}catch{}}async function L(){try{const i=await x.get(N.brands.list,{params:{all:!0}});f.value=i.data.data||[]}catch{}}function Q(i){switch(parseInt(i)){case 1:return"Hoạt động";case 0:return"Không hoạt động";default:return"Không xác định"}}function R(i){switch(parseInt(i)){case 1:return"bg-green-100 text-green-800";case 0:return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}}return G(()=>{b(),O(),L()}),(i,g)=>(u(),m("div",{class:"container mx-auto p-4"},[z(ee,{title:"Quản lý sản phẩm",items:n(T),loading:n(l),pagination:n(h),"selected-items":n(k),"add-button-text":"Thêm sản phẩm mới",onAdd:n(K),onEdit:n(B),onDelete:n(H),onPageChange:n(o),onToggleAll:n(I),onToggleItem:n(D)},{header:V(()=>[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"ID"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Hình ảnh"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Tên sản phẩm"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Danh mục"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Thương hiệu"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Giá"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Trạng thái")]),row:V(({item:s})=>[t("td",{class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},p(s.id),1),t("td",{class:"px-6 py-4 whitespace-nowrap"},[s.thumbnail?(u(),m("img",{key:0,src:s.thumbnail,alt:"Thumbnail",class:"h-10 w-10 object-contain"},null,8,["src"])):(u(),m("span",{key:1,class:"text-gray-400"},"Không có ảnh"))]),t("td",{class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},p(s.name),1),t("td",{class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},p(s.category_name),1),t("td",{class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},p(s.brand_name),1),t("td",{class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},p(new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(s.price)),1),t("td",{class:"px-6 py-4 whitespace-nowrap"},[t("span",{class:P(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",R(s.status)])},p(Q(s.status)),3)])]),filters:V(()=>[t("div",{class:"flex flex-wrap gap-4"},[t("div",{class:"flex-1"},[t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tìm kiếm"),$(t("input",{"onUpdate:modelValue":g[0]||(g[0]=s=>n(e).search=s),type:"text",placeholder:"Tìm theo tên sản phẩm",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",onKeyup:g[1]||(g[1]=J((...s)=>n(r)&&n(r)(...s),["enter"]))},null,544),[[Y,n(e).search]])]),t("div",{class:"flex-1"},[t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Danh mục"),$(t("select",{"onUpdate:modelValue":g[2]||(g[2]=s=>n(e).category_id=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"},[t("option",{value:""},"Tất cả danh mục"),(u(!0),m(A,null,M(c.value,s=>(u(),m("option",{key:s.id,value:s.id},p(s.name),9,["value"]))),128))],512),[[F,n(e).category_id]])]),t("div",{class:"flex-1"},[t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Thương hiệu"),$(t("select",{"onUpdate:modelValue":g[3]||(g[3]=s=>n(e).brand_id=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"},[t("option",{value:""},"Tất cả thương hiệu"),(u(!0),m(A,null,M(f.value,s=>(u(),m("option",{key:s.id,value:s.id},p(s.name),9,["value"]))),128))],512),[[F,n(e).brand_id]])]),t("div",{class:"flex-1"},[t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Trạng thái"),$(t("select",{"onUpdate:modelValue":g[4]||(g[4]=s=>n(e).status=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"},[t("option",{value:""},"Tất cả trạng thái"),t("option",{value:"1"},"Hoạt động"),t("option",{value:"0"},"Không hoạt động")],512),[[F,n(e).status]])]),t("div",{class:"flex-none self-end"},[t("button",{onClick:g[5]||(g[5]=(...s)=>n(r)&&n(r)(...s)),class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none mr-2"}," Lọc "),t("button",{onClick:g[6]||(g[6]=(...s)=>n(j)&&n(j)(...s)),class:"px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 focus:outline-none"}," Đặt lại ")])])]),_:1},8,["items","loading","pagination","selected-items","onAdd","onEdit","onDelete","onPageChange","onToggleAll","onToggleItem"]),n(y)?(u(),q(_,{key:0,show:n(y),title:"Xác nhận xóa",message:`Bạn có chắc chắn muốn xóa sản phẩm ${n(C)?.name||""}?`,"on-close":n(a),onConfirm:n(S)},null,8,["show","message","on-close","onConfirm"])):w("",!0)]))}};export{ie as default};
