import{M as B}from"./D_ZLElLM.js";import{_ as I}from"./BOPsCARg.js";import{_ as U}from"./yLpPWoGU.js";import"./B4pxijLT.js";import{u as $}from"./DCKoXk_D.js";import{u as R}from"./D6Zc0C2O.js";import{_ as j}from"./Bn5CcRjN.js";import{ac as A,I as d,O as E,z as M,a9 as N,c as _,o as v,a as f,e as w,t as S,_ as q,a7 as L,M as F,G as V,b as P,i as T,d as h,H as O,j as z}from"./DDT-0HTi.js";import{_ as H}from"./DlAUqK2U.js";import"./Bj1hfyy3.js";const G={__name:"CoreContentCKEditorUltimate",props:{modelValue:{type:String,default:""},placeholder:{type:String,default:"Nhập nội dung..."},height:{type:String,default:"400px"},disabled:{type:Boolean,default:!1},config:{type:Object,default:()=>({})}},emits:["update:modelValue","ready","change"],setup(u,{expose:K,emit:r}){A(e=>({"1198e2d9":u.height}));const n=u,g=r,s=d(null),t=d(null),c=d(!0),i=d(null),D=async()=>{try{if(!CKEditor){const e=await q(()=>import("./tSlPv4y6.js").then(a=>a.c),[],import.meta.url);return CKEditor=e.default||e,!0}return!!CKEditor}catch(e){return i.value="Không thể tải trình soạn thảo",console.error("CKEditor load error:",e),!1}},b=async()=>{try{if(c.value=!0,i.value=null,!CKEditor&&!await D()){i.value="Không thể tải trình soạn thảo";return}if(!s.value){i.value="Container không tồn tại";return}if(!CKEditor.create){i.value="CKEditor không được khởi tạo đúng cách",console.error("CKEditor object:",CKEditor);return}const e={placeholder:n.placeholder,toolbar:{items:["heading","|","bold","italic","underline","strikethrough","|","fontSize","fontFamily","fontColor","fontBackgroundColor","|","alignment","|","numberedList","bulletedList","|","indent","outdent","|","link","blockQuote","insertTable","mediaEmbed","|","undo","redo"]},table:{contentToolbar:["tableColumn","tableRow","mergeTableCells"]},mediaEmbed:{previewsInData:!0},...n.config};t.value=await CKEditor.create(s.value,e),n.modelValue&&t.value.setData(n.modelValue),t.value.model.document.on("change:data",()=>{const a=t.value.getData();g("update:modelValue",a),g("change",a)}),g("ready",t.value),n.disabled&&(t.value.isReadOnly=!0)}catch(e){i.value="Lỗi khởi tạo trình soạn thảo",console.error("Editor init error:",e)}finally{c.value=!1}};E(()=>n.modelValue,e=>{t.value&&e!==t.value.getData()&&t.value.setData(e||"")},{immediate:!1}),E(()=>n.disabled,e=>{t.value&&(t.value.isReadOnly=e)}),E(()=>n.config,()=>{t.value&&(x(),L(()=>{b()}))},{deep:!0});const C=d(!1),m=d(null);M(()=>{typeof IntersectionObserver<"u"?(m.value=new IntersectionObserver(e=>{e.forEach(a=>{C.value=a.isIntersecting,a.isIntersecting&&!t.value&&setTimeout(()=>{b()},100)})}),s.value&&m.value.observe(s.value)):setTimeout(()=>{b()},100)}),N(()=>{m.value&&m.value.disconnect(),x()});const x=async()=>{if(t.value){try{await t.value.destroy()}catch(e){console.error("CKEditor destroy error:",e)}t.value=null}};return K({editor:()=>t.value,getData:()=>t.value?.getData()||"",setData:e=>t.value?.setData(e),isReadOnly:e=>{t.value&&(t.value.isReadOnly=e)}}),(e,a)=>(v(),_("div",{class:"ckeditor-container"},[c.value?(v(),_("div",{key:0,class:"flex items-center justify-center p-8 border-2 border-dashed border-gray-300 rounded-lg"},[f("div",{class:"text-center"},[f("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),f("p",{class:"text-gray-600"},"Đang tải trình soạn thảo...")])])):(v(),_("div",{key:1},[f("div",{ref_key:"editorContainer",ref:s,class:"editor-container"},null,512),i.value?(v(),_("div",{key:0,class:"mt-2 text-red-600 text-sm"},S(i.value),1)):w("",!0)]))]))}},Q=H(G,[["__scopeId","data-v-7c2908cd"]]),re={__name:"form",props:{show:Boolean,category:Object,parentCategories:{type:Array,default:()=>[]},statusEnums:{type:Array,default:()=>[]},apiErrors:{type:Object,default:()=>({})},loading:{type:Boolean,default:!1}},emits:["submit","cancel"],setup(u,{emit:K}){F();const r=u,n=K,g=V(()=>r.category?"Chỉnh sửa danh mục":"Thêm danh mục mới"),s=V({get:()=>r.show,set:()=>C()}),t=$(r,"category",{name:"",parent_id:"",slug:"",description:"",status:"",image:null,remove_image:!1}),c=d(null);E(()=>r.category,a=>{a?c.value=null:i()},{immediate:!0});function i(){c.value=null}const D=V(()=>({name:[{required:"Tên danh mục là bắt buộc."},{max:[100,"Tên danh mục không được vượt quá 100 ký tự."]}],description:[{max:[2e3,"Mô tả không được vượt quá 2000 ký tự."]}],parent_id:[{notSelf:["Danh mục không thể là danh mục cha của chính nó."]}]}));function b(a){n("submit",a)}function C(){n("cancel")}const m=V(()=>{const a=[{value:"",label:"Không có (Danh mục gốc)"}];return Array.isArray(r.parentCategories)&&a.push(...r.parentCategories.map(y=>({value:y.id,label:y.name}))),a}),x=V(()=>(r.statusEnums||[]).map(a=>({value:a.value,label:a.label}))),e=R(r,"category","image");return(a,y)=>(v(),P(B,{modelValue:s.value,"onUpdate:modelValue":y[0]||(y[0]=o=>s.value=o),title:g.value,loading:u.loading},{default:T(()=>[h(I,{"default-values":O(t),rules:D.value,"api-errors":u.apiErrors,"submit-text":u.category?"Cập nhật":"Thêm mới",onSubmit:b,onCancel:C},{default:T(({form:o,errors:p,clearError:k,isSubmitting:J})=>[h(U,{modelValue:o.name,"onUpdate:modelValue":[l=>o.name=l,l=>k("name")],label:"Tên danh mục",name:"name",error:p.name,required:"",autocomplete:"name"},null,8,["modelValue","onUpdate:modelValue","error"]),h(U,{modelValue:o.parent_id,"onUpdate:modelValue":[l=>o.parent_id=l,l=>k("parent_id")],label:"Danh mục cha",name:"parent_id",type:"select",options:m.value,error:p.parent_id},{help:T(()=>[z("Không có (Danh mục gốc)")]),_:2},1032,["modelValue","onUpdate:modelValue","options","error"]),h(Q,{modelValue:o.description,"onUpdate:modelValue":[l=>o.description=l,l=>k("description")],label:"Mô tả chi tiết",error:p.description,placeholder:"Nhập mô tả chi tiết cho danh mục với đầy đủ tính năng định dạng...",height:"400px"},null,8,["modelValue","onUpdate:modelValue","error"]),f("div",null,[f("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Hình ảnh"),h(j,{modelValue:o.image,"onUpdate:modelValue":l=>o.image=l,"default-url":O(e)},null,8,["modelValue","onUpdate:modelValue","default-url"]),p.image?(v(),_("div",{key:0,class:"text-red-500 text-sm mt-1"},S(p.image),1)):w("",!0)]),h(U,{modelValue:o.status,"onUpdate:modelValue":[l=>o.status=l,l=>k("status")],label:"Trạng thái",name:"status",type:"select",options:x.value,error:p.status},null,8,["modelValue","onUpdate:modelValue","options","error"])]),_:1},8,["default-values","rules","api-errors","submit-text"])]),_:1},8,["modelValue","title","loading"]))}};export{re as default};
