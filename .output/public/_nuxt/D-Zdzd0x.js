import{M as U}from"./D3qKhv56.js";import{_ as q}from"./D_8RvcO3.js";import{I as S,G as f,z as F,a9 as P,c as u,o as i,e as b,a as n,t as c,k as j,F as N,g as _,j as h,w as z,O as D,b as L,i as B,d as I,H as T}from"./CRPNSmKO.js";import{e as C}from"./B4pxijLT.js";import{u as G}from"./DlAtJ9EQ.js";import{a as $}from"./CaxYi4Fr.js";import"./DlAUqK2U.js";const H={__name:"CoreSelectMultipleSelect",props:{modelValue:{type:Array,default:()=>[]},options:{type:Array,default:()=>[]},label:{type:String,default:""},placeholder:{type:String,default:"Chọn..."},error:{type:String,default:""}},emits:["update:modelValue"],setup(o,{emit:x}){const s=o,p=x,a=S(!1),g=f(()=>s.modelValue.map(t=>{const r=s.options.find(l=>l.value==t);return{value:t,label:r?r.label:t}}));function v(){a.value=!a.value}function V(t){const r=[...s.modelValue],l=r.indexOf(t);l>-1?r.splice(l,1):r.push(t),p("update:modelValue",r)}function w(t){const r=s.modelValue.filter(l=>l!==t);p("update:modelValue",r)}function y(t){t.target.closest(".relative")||(a.value=!1)}return F(()=>{document.addEventListener("click",y)}),P(()=>{document.removeEventListener("click",y)}),(t,r)=>(i(),u("div",null,[o.label?(i(),u("label",{key:0,class:"block text-sm font-medium mb-1"},c(o.label),1)):b("",!0),n("div",{class:"relative"},[n("div",{onClick:v,class:j(["w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 cursor-pointer bg-white",{"border-red-500":o.error}])},[n("div",{class:"flex flex-wrap gap-1"},[o.modelValue.length===0?(i(),u("span",{key:0,class:"text-gray-500"},c(o.placeholder),1)):b("",!0),(i(!0),u(N,null,_(g.value,l=>(i(),u("span",{key:l.value,class:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-indigo-100 text-indigo-800"},[h(c(l.label)+" ",1),n("button",{onClick:z(k=>w(l.value),["stop"]),class:"ml-1 text-indigo-600 hover:text-indigo-800"}," × ",8,["onClick"])]))),128))])],2),a.value?(i(),u("div",{key:0,class:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto"},[(i(!0),u(N,null,_(o.options,l=>(i(),u("div",{key:l.value,onClick:k=>V(l.value),class:"px-3 py-2 hover:bg-gray-100 cursor-pointer flex items-center"},[n("input",{type:"checkbox",checked:o.modelValue.includes(l.value),class:"mr-2 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500",readonly:""},null,8,["checked"]),h(" "+c(l.label),1)],8,["onClick"]))),128))])):b("",!0)]),o.error?(i(),u("p",{key:1,class:"mt-1 text-sm text-red-600"},c(o.error),1)):b("",!0)]))}},le={__name:"assign-role",props:{show:Boolean,user:Object,onClose:Function},emits:["role-assigned"],setup(o,{emit:x}){const s=o,p=x,a=S(null),g=S([]);f(()=>`Phân quyền cho ${a.value?.name||a.value?.username||"người dùng"}`);const v=f({get:()=>s.show,set:()=>A()});D(()=>s.show,async e=>{e&&s.user?.id&&await Promise.all([V(),w()])},{immediate:!0});async function V(){try{const e=await $.get(C.users.showWithRoles(s.user.id));e.data.success&&(a.value=e.data.data)}catch(e){console.error("Error fetching user detail:",e)}}async function w(){try{const e=await $.get(C.roles.list);e.data.success?g.value=e.data.data:console.error("Roles API returned success: false")}catch(e){console.error("Error loading roles:",e)}}const y=f(()=>{const e=a.value||{};let d=[];return e.roles&&Array.isArray(e.roles)&&(d=e.roles.map(m=>m.id)),{role_ids:d,...e}}),{apiErrors:t,submit:r}=G({endpoint:C.users.assignRoles(s.user?.id),emit:p,onClose:s.onClose,eventName:"role-assigned",method:"post"}),l=f(()=>({role_ids:[{required:"Vui lòng chọn ít nhất một vai trò."}]})),k=f(()=>(g.value||[]).map(e=>({value:e.id,label:e.name})));async function M(e){const d={role_ids:Array.isArray(e.role_ids)?e.role_ids:[e.role_ids].filter(Boolean)};await r(d)}function A(){p("role-assigned")}return(e,d)=>(i(),L(U,{modelValue:v.value,"onUpdate:modelValue":d[0]||(d[0]=m=>v.value=m),title:"Phân quyền người dùng"},{default:B(()=>[I(q,{"default-values":y.value,rules:l.value,"api-errors":T(t),"submit-text":"Cập nhật quyền",onSubmit:M,onCancel:A},{default:B(({form:m,errors:O,clearError:R,isSubmitting:W})=>[n("div",{class:"mb-4 p-3 bg-gray-50 rounded-lg"},[n("div",{class:"text-sm text-gray-600"},[n("div",null,[n("strong",null,"Tên:"),h(" "+c(a.value?.name||a.value?.username||"N/A"),1)]),n("div",null,[n("strong",null,"Email:"),h(" "+c(a.value?.email||"N/A"),1)])])]),I(H,{modelValue:m.role_ids,"onUpdate:modelValue":[E=>m.role_ids=E,E=>R("role_ids")],label:"Vai trò",options:k.value,error:O.role_ids,placeholder:"Chọn vai trò..."},null,8,["modelValue","onUpdate:modelValue","options","error"])]),_:1},8,["default-values","rules","api-errors"])]),_:1},8,["modelValue"]))}};export{le as default};
