import{a as U}from"./Bj1hfyy3.js";import{I as g,O as k,c as r,o,a as s,e as v,t as C}from"./DDT-0HTi.js";const I={__name:"CoreImageUploader",props:{modelValue:File||String||null,defaultUrl:String||null},emits:["update:modelValue","remove"],setup(h,{emit:y}){const n=h,i=y,t=g(null),u=g(!1),a=g("");k(()=>n.modelValue,e=>{e instanceof File?t.value=URL.createObjectURL(e):typeof e=="string"&&e?t.value=c(e):t.value=n.defaultUrl?c(n.defaultUrl):null},{immediate:!0});function c(e){return e?e.startsWith("http")?e:e.startsWith("/storage/")?e.replace(/^(\/storage\/)+/,"/storage/"):`/storage/${e.replace(/^\/storage\//,"")}`:null}async function b(e){const d=e.target.files[0];if(d){u.value=!0,a.value="";try{const l=new FormData;l.append("image",d);const f=await U.post("/api/upload-image",l,{headers:{"Content-Type":"multipart/form-data"}}),p=f.data.data||f.data,m=p.url||p.path||p.image;m?(i("update:modelValue",m),t.value=c(m)):a.value="Upload thất bại: Không nhận được URL!"}catch(l){l.response?.data?.message?a.value=`Upload thất bại: ${l.response.data.message}`:l.message?a.value=`Upload thất bại: ${l.message}`:a.value="Upload thất bại!"}finally{u.value=!1}}}function w(){i("update:modelValue",null),i("remove"),t.value=null}function x(e){e.target.onerror=null,t.value=null}return(e,d)=>(o(),r("div",null,[t.value?(o(),r("div",{key:0,class:"mb-2 relative inline-block"},[s("img",{src:t.value,alt:"preview",class:"w-20 h-20 object-cover rounded-full border",onError:x},null,40,["src"]),s("button",{type:"button",onClick:w,class:"absolute top-0 right-0 bg-white bg-opacity-80 rounded-full p-1 shadow hover:bg-red-100 transition",style:{transform:"translate(40%, -40%)"},title:"Xóa ảnh"},[(o(),r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})]))])])):(o(),r("div",{key:1,class:"w-20 h-20 flex items-center justify-center bg-gray-100 rounded-full border text-gray-400"},[s("span",null,"No Image")])),s("input",{type:"file",onChange:b,accept:"image/*"},null,32),u.value?(o(),r("div",{key:2,class:"text-xs text-gray-500 mt-1"},"Đang upload ảnh...")):v("",!0),a.value?(o(),r("div",{key:3,class:"text-xs text-red-500 mt-1"},C(a.value),1)):v("",!0)]))}};export{I as _};
